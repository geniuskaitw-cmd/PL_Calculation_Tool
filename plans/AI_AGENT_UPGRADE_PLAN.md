# AI Agent æ¶æ§‹å‡ç´šå¯¦ä½œè¨ˆç•«ï¼ˆæœ€çµ‚å®Œæ•´ç‰ˆï¼‰

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

**ç›®æ¨™**: å°‡ç•¶å‰çš„ AI Tool Calling ç³»çµ±å‡ç´šç‚ºå®Œæ•´çš„ AI Agent æ¶æ§‹ï¼Œä½¿ AI èƒ½å¤ è‡ªä¸»è¦åŠƒä¸¦é”æˆè¤‡é›œçš„è²¡å‹™ç›®æ¨™

**æ ¸å¿ƒå•é¡Œ**: ç¾æœ‰ AI åªèƒ½åŸ·è¡Œå–®ä¸€åŸå­æ“ä½œï¼Œç„¡æ³•ç†è§£ç•¶å‰ç‹€æ…‹ã€è¦åŠƒå¤šæ­¥é©Ÿã€è¿­ä»£å„ªåŒ–è‡³ç›®æ¨™

**è§£æ±ºæ–¹æ¡ˆ**: å¯¦ä½œ ReAct (Reasoning + Acting) Agent æ¨¡å¼ï¼Œè³¦äºˆ AIã€Œè§€å¯Ÿâ†’æ€è€ƒâ†’è¡Œå‹•ã€çš„å¾ªç’°èƒ½åŠ›

---

## ğŸ¯ ç•¶å‰æ¶æ§‹åˆ†æ

### ç¾æœ‰èƒ½åŠ›ï¼ˆå·²å¯¦ä½œï¼‰
- âœ… åŸºæœ¬å°è©±åŠŸèƒ½
- âœ… OpenAI Function Calling æ•´åˆ
- âœ… 3 å€‹åŸå­å·¥å…·:
  - `updateMonthlyPlan()`: æ›´æ–°å–®æœˆå–®æ¬„ä½
  - `updateRetention()`: æ›´æ–°å–®ä¸€ç•™å­˜éŒ¨é»
  - `applyPreset()`: å¥—ç”¨é è¨­æ¨¡å‹

### æ ¸å¿ƒé™åˆ¶èˆ‡é—œéµå ´æ™¯

#### é™åˆ¶ 1: **AI æ˜¯ã€Œç›²äººã€** - ç„¡æ³•è®€å–ç•¶å‰ç‹€æ…‹

**å½±éŸ¿å…©å€‹é—œéµå ´æ™¯**ï¼š

**å ´æ™¯ Aï¼šå„ªåŒ–ç¾æœ‰æ•¸æ“šï¼ˆä¿®æ”¹æ¨¡å¼ï¼‰**
```
ç”¨æˆ¶: ã€Œæˆ‘å·²ç¶“å¡«äº† M1-M6ï¼Œä½†åˆ©æ½¤å¤ªä½ï¼Œå¹«æˆ‘å„ªåŒ–åˆ° 500 è¬ã€
ç•¶å‰å•é¡Œ: AI çœ‹ä¸åˆ°ç•¶å‰åˆ©æ½¤æ˜¯å¤šå°‘ï¼Œç„¡æ³•è©•ä¼°éœ€è¦èª¿æ•´å¤šå°‘
éœ€è¦èƒ½åŠ›: get_current_state() - è®€å–ä¸¦ç†è§£ç•¶å‰ç‹€æ…‹
```

**å ´æ™¯ Bï¼šå¾é›¶é–‹å§‹è¦åŠƒï¼ˆå‰µå»ºæ¨¡å¼ï¼‰**
```
ç”¨æˆ¶: ã€ŒRPG éŠæˆ²ï¼Œ24 å€‹æœˆï¼Œ3000 è¬é ç®—ï¼Œç›®æ¨™ 800 è¬åˆ©æ½¤ã€
ç•¶å‰å•é¡Œ: AI ç„¡æ³•é©—è­‰ç”Ÿæˆçš„è¨ˆç•«æ˜¯å¦é”æ¨™
éœ€è¦èƒ½åŠ›: 
1. ç†è§£ç”¨æˆ¶èªå¢ƒï¼ˆéŠæˆ²é¡å‹ã€æœŸé–“ã€é ç®—ã€ç›®æ¨™ï¼‰
2. åƒè€ƒçŸ¥è­˜åº«ï¼ˆè¡Œæ¥­åŸºæº–ï¼‰
3. ç”Ÿæˆå®Œæ•´ JSON è¨ˆç•«
4. ä¸€æ¬¡æ€§å°å…¥ä¸¦é©—è­‰
```

#### é™åˆ¶ 2: **å·¥å…·å¤ªåŸå­åŒ–** - ä¸€æ¬¡åªèƒ½æ”¹ä¸€å€‹æ¬„ä½
- è¦èª¿æ•´ 24 å€‹æœˆéœ€è¦èª¿ç”¨ 24 æ¬¡
- æ•ˆç‡ä½ä¸‹ï¼Œå®¹æ˜“å‡ºéŒ¯
- ç„¡æ³•åŸ·è¡Œæ‰¹é‡å„ªåŒ–
- **JSON å‚³è¼¸æ¯”é€æ¬„ä½æ›´é«˜æ•ˆã€æ›´æ˜“ç†è§£**

#### é™åˆ¶ 3: **ç„¡åé¥‹å¾ªç’°** - ç„¡æ³•è¿­ä»£å„ªåŒ–
- åŸ·è¡Œå¾Œç„¡æ³•ç¢ºèªçµæœ
- ç„¡æ³•æ ¹æ“šçµæœèª¿æ•´ç­–ç•¥
- ä¸€æ¬¡æ€§åŸ·è¡Œï¼Œç„¡æ³•é”æˆè¤‡é›œç›®æ¨™

### æ¶æ§‹åœ–ï¼šç•¶å‰ vs ç›®æ¨™

```mermaid
graph TD
    subgraph "ç•¶å‰æ¶æ§‹ï¼ˆé™åˆ¶ï¼‰"
        U1[ç”¨æˆ¶è«‹æ±‚] -->|å–®ä¸€æŒ‡ä»¤| AI1[AI]
        AI1 -->|ç›²ç›®åŸ·è¡Œ| T1[åŸå­å·¥å…·<br/>å–®æ¬„ä½æ›´æ–°]
        T1 -->|ç„¡åé¥‹| S1[æ‡‰ç”¨ç‹€æ…‹]
    end
    
    subgraph "ç›®æ¨™æ¶æ§‹ï¼ˆAgentï¼‰"
        U2[ç”¨æˆ¶ç›®æ¨™] -->|è¤‡é›œéœ€æ±‚| AI2[AI Agent]
        
        AI2 -->|1.è§€å¯Ÿ| R[è®€å–ç‹€æ…‹<br/>JSONæ ¼å¼]
        R -->|çµæ§‹åŒ–æ•¸æ“š| AI2
        
        AI2 -->|2.åƒè€ƒ| KB[çŸ¥è­˜åº«<br/>è¡Œæ¥­åŸºæº–]
        KB -->|æ¨¡æ¿æ•¸æ“š| AI2
        
        AI2 -->|3.æ€è€ƒ| AI2
        
        AI2 -->|4.è¡Œå‹•| T2[æ‰¹é‡å·¥å…·<br/>JSONå°å…¥]
        T2 -->|åŸ·è¡Œ| S2[æ‡‰ç”¨ç‹€æ…‹]
        
        S2 -->|5.é©—è­‰| R
        
        AI2 -->|é”æˆ| U2
    end
    
    style R fill:#e1f5e1
    style KB fill:#fff5e1
    style T2 fill:#e1e5f5
```

---

## ğŸ—ï¸ å‡ç´šæ–¹æ¡ˆè¨­è¨ˆ

### Phase 1: è®€å–èƒ½åŠ›ï¼ˆObservationï¼‰ - JSON æ ¼å¼

#### 1.1 å¯¦ä½œ `get_current_state` å·¥å…·

**ç›®çš„**: è®“ AI èƒ½å¤ ã€Œçœ‹è¦‹ã€ç•¶å‰è²¡å‹™ç‹€æ…‹ï¼Œä¸¦ä»¥çµæ§‹åŒ– JSON è¿”å›

**ç‚ºä»€éº¼ç”¨ JSONï¼Ÿ**
- âœ… AI å¯ä»¥ç›´æ¥è§£ææ•¸å­—ï¼Œä¸æœƒèª¤è®€
- âœ… æ”¯æ´è¤‡é›œçš„æ•¸æ“šåˆ†æï¼ˆä¾‹å¦‚æ‰¾å‡ºåˆ©æ½¤æœ€ä½çš„æœˆä»½ï¼‰
- âœ… å¯ä»¥ç›´æ¥æ¯”å°ç›®æ¨™å€¼ï¼ˆ`acc_profit: 8200000 >= target: 8000000 âœ“`ï¼‰

**å¾Œç«¯ Function å®šç¾©** (`app/api/chat/route.ts`)
```typescript
{
  name: "get_current_state",
  description: "ç²å–ç•¶å‰è²¡å‹™ç‹€æ…‹ç¸½è¦½ï¼Œä»¥çµæ§‹åŒ– JSON è¿”å›",
  parameters: {
    type: "object",
    properties: {
      detail_level: {
        type: "string",
        enum: ["summary", "detailed"],
        description: "summary=ç¸½è¦½æŒ‡æ¨™, detailed=åŒ…å«æ‰€æœ‰æœˆä»½æ•¸æ“š"
      }
    },
    required: ["detail_level"]
  }
}
```

**å‰ç«¯åŸ·è¡Œé‚è¼¯** (`components/ai-chat-modal.tsx`)
```typescript
if (name === "get_current_state") {
  const { detail_level } = parsedArgs
  const { plData, timeline, settings, rrModel } = useFinance()
  
  // è¨ˆç®—ç¸½è¦½æŒ‡æ¨™
  const opsMonths = plData.filter(m => !m.isDev)
  const summary = {
    ç¸½æœˆæ•¸: opsMonths.length,
    é–‹ç™¼æœˆæ•¸: timeline.filter(m => m.isDev).length,
    ç´¯ç©åˆ©æ½¤: plData[plData.length - 1]?.accProfit || 0,
    ç¸½é ç®—: plData.reduce((sum, m) => sum + m.marketingCost, 0),
    ç¸½æµæ°´: plData.reduce((sum, m) => sum + m.grossRevenue, 0),
    å¹³å‡ARPDAU: opsMonths.length > 0 
      ? (opsMonths.reduce((sum, m) => sum + m.arpdau, 0) / opsMonths.length).toFixed(2)
      : 0,
    å¹³å‡NUU: opsMonths.length > 0
      ? Math.round(opsMonths.reduce((sum, m) => sum + m.nuu, 0) / opsMonths.length)
      : 0,
    æœ€çµ‚ROAS: plData.length > 0 && plData.reduce((sum, m) => sum + m.marketingCost, 0) > 0
      ? ((plData.reduce((sum, m) => sum + m.grossRevenue, 0) / 
          plData.reduce((sum, m) => sum + m.marketingCost, 0)) * 100).toFixed(1)
      : 0
  }
  
  if (detail_level === "detailed") {
    const monthly = plData.map(m => ({
      æœˆä»½: m.monthLabel,
      æœˆä»½ç´¢å¼•: m.monthIndex,
      æ˜¯å¦é–‹ç™¼æœŸ: m.isDev,
      NUU: m.nuu,
      è¡ŒéŠ·é ç®—: m.marketingCost,
      ARPDAU: m.arpdau,
      CPI: m.ecpa,
      DAU: m.dau,
      ç¸½æµæ°´: m.grossRevenue,
      æœˆåˆ©æ½¤: m.profit,
      ç´¯ç©åˆ©æ½¤: m.accProfit
    }))
    
    const retention = {
      æ¨¡å‹: rrModel.interpolationMode === "smart_curvature" ? "æ™ºèƒ½æ›²ç‡" : "ç·šæ€§å°æ•¸",
      æ¬¡ç•™: rrModel.default[1] || 0,
      ä¸ƒç•™: rrModel.default[7] || 0,
      æœˆç•™: rrModel.default[30] || 0
    }
    
    result = JSON.stringify({ summary, monthly, retention }, null, 2)
  } else {
    result = JSON.stringify({ summary }, null, 2)
  }
  
  return result
}
```

**è¿”å›æ•¸æ“šçµæ§‹**
```typescript
interface CurrentState {
  summary: {
    ç¸½æœˆæ•¸: number
    é–‹ç™¼æœˆæ•¸: number
    ç´¯ç©åˆ©æ½¤: number
    ç¸½é ç®—: number
    ç¸½æµæ°´: number
    å¹³å‡ARPDAU: string
    å¹³å‡NUU: number
    æœ€çµ‚ROAS: string
  }
  monthly?: Array<{
    æœˆä»½: string
    æœˆä»½ç´¢å¼•: number
    æ˜¯å¦é–‹ç™¼æœŸ: boolean
    NUU: number
    è¡ŒéŠ·é ç®—: number
    ARPDAU: number
    CPI: number
    DAU: number
    ç¸½æµæ°´: number
    æœˆåˆ©æ½¤: number
    ç´¯ç©åˆ©æ½¤: number
  }>
  retention?: {
    æ¨¡å‹: string
    æ¬¡ç•™: number
    ä¸ƒç•™: number
    æœˆç•™: number
  }
}
```

---

### Phase 2: å®Œæ•´ JSON å°å…¥ï¼ˆå¾é›¶é–‹å§‹è¦åŠƒï¼‰

#### 2.1 å¯¦ä½œ `import_complete_plan` å·¥å…·

**ç›®çš„**: è®“ AI èƒ½å¤ ä¸€æ¬¡æ€§ç”Ÿæˆä¸¦å°å…¥å®Œæ•´çš„ 24 æœˆè¨ˆç•«ï¼Œæ”¯æ´ã€Œå¾é›¶é–‹å§‹è¦åŠƒã€å ´æ™¯

**ç‚ºä»€éº¼éœ€è¦é€™å€‹å·¥å…·ï¼Ÿ**
- âœ… **å ´æ™¯ B çš„æ ¸å¿ƒéœ€æ±‚**ï¼šç”¨æˆ¶èªªã€ŒRPG éŠæˆ²ï¼Œ24 æœˆï¼Œ3000 è¬ï¼Œè³º 800 è¬ã€
- âœ… **AI ä¸€æ¬¡çœ‹åˆ°å®Œæ•´è¨ˆç•«**ï¼Œæ›´å®¹æ˜“ç†è§£æ•´é«”ç­–ç•¥
- âœ… **æ¸›å°‘å·¥å…·èª¿ç”¨æ¬¡æ•¸**ï¼ˆ1 æ¬¡ vs 24 æ¬¡ï¼‰
- âœ… **åŸå­æ€§ä¿è­‰**ï¼ˆå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±æ•—ï¼‰
- âœ… **æ›´ç¬¦åˆäººé¡æ€ç¶­**ï¼ˆå…ˆè¦åŠƒå†åŸ·è¡Œï¼‰

**å¾Œç«¯ Function å®šç¾©** (`app/api/chat/route.ts`)
```typescript
{
  name: "import_complete_plan",
  description: "å°å…¥å®Œæ•´çš„è²¡å‹™è¨ˆç•« JSONï¼Œä¸€æ¬¡æ€§è¨­å®šæ‰€æœ‰æœˆä»½æ•¸æ“šå’Œç•™å­˜æ¨¡å‹",
  parameters: {
    type: "object",
    properties: {
      plan: {
        type: "object",
        properties: {
          retention_model: {
            type: "string",
            enum: ["A", "B", "C", "D", "E", "F"],
            description: "ç•™å­˜æ¨¡å‹ IDï¼ˆA=SLGé«˜, B=RPG, C=SLGä½, D=ä¼‘é–’, E=è¶…ä¼‘é–’, F=è‡ªå®šç¾©ï¼‰"
          },
          timeline: {
            type: "array",
            description: "æœˆåº¦è¨ˆç•«æ•¸æ“š",
            items: {
              type: "object",
              properties: {
                monthIndex: { type: "number", description: "æœˆä»½ç´¢å¼•ï¼ˆ1=M1, 2=M2...ï¼‰" },
                nuu: { type: "number", description: "æ–°å¢ç”¨æˆ¶æ•¸" },
                marketing: { type: "number", description: "è¡ŒéŠ·é ç®—ï¼ˆå…ƒï¼‰" },
                arpdau: { type: "number", description: "æ¯æ—¥æ´»èºç”¨æˆ¶å¹³å‡æ”¶å…¥ï¼ˆç¾é‡‘ï¼‰" },
                ecpa: { type: "number", description: "æœ‰æ•ˆç²å®¢æˆæœ¬ï¼ˆç¾é‡‘ï¼‰" }
              },
              required: ["monthIndex", "nuu", "marketing", "arpdau"]
            }
          }
        },
        required: ["timeline"]
      }
    },
    required: ["plan"]
  }
}
```

**å‰ç«¯åŸ·è¡Œé‚è¼¯** (`components/ai-chat-modal.tsx`)
```typescript
if (name === "import_complete_plan") {
  const { plan } = parsedArgs
  const { timeline, updateMonth, setRrModel } = useFinance()
  
  try {
    // 1. å¥—ç”¨ç•™å­˜æ¨¡å‹ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰
    if (plan.retention_model) {
      console.log(`ğŸ”§ å¥—ç”¨ç•™å­˜æ¨¡å‹: ${plan.retention_model}`)
      const modelData = await fetch(`/models/${plan.retention_model}.json`)
        .then(r => r.json())
      
      setRrModel(prev => ({
        ...prev,
        default: modelData.anchors
      }))
      
      toast.success(`âœ… å·²å¥—ç”¨ ${plan.retention_model} ç•™å­˜æ¨¡å‹`)
    }
    
    // 2. æ‰¹é‡æ›´æ–°æœˆä»½æ•¸æ“š
    let successCount = 0
    let failCount = 0
    
    plan.timeline.forEach(monthData => {
      const targetMonth = timeline.find(m => m.monthIndex === monthData.monthIndex)
      
      if (targetMonth) {
        // é€æ¬„ä½æ›´æ–°ï¼ˆåˆ©ç”¨ç¾æœ‰çš„ updateMonth å‡½æ•¸ï¼‰
        if (monthData.nuu !== undefined) {
          updateMonth(targetMonth.id, 'nuu', monthData.nuu)
        }
        if (monthData.marketing !== undefined) {
          updateMonth(targetMonth.id, 'marketing', monthData.marketing)
        }
        if (monthData.arpdau !== undefined) {
          updateMonth(targetMonth.id, 'arpdau', monthData.arpdau)
        }
        if (monthData.ecpa !== undefined) {
          updateMonth(targetMonth.id, 'ecpa', monthData.ecpa)
        }
        successCount++
      } else {
        console.warn(`âš ï¸ æ‰¾ä¸åˆ°æœˆä»½: M${monthData.monthIndex}`)
        failCount++
      }
    })
    
    result = `æˆåŠŸå°å…¥å®Œæ•´è¨ˆç•«ï¼\nâœ… æˆåŠŸ: ${successCount} å€‹æœˆ\n${failCount > 0 ? `âš ï¸ å¤±æ•—: ${failCount} å€‹æœˆ` : ''}`
    toast.success(result)
    
  } catch (err: any) {
    result = `å°å…¥å¤±æ•—: ${err.message}`
    toast.error(result)
  }
  
  return result
}
```

**AI ç”Ÿæˆç¯„ä¾‹**ï¼ˆRPG éŠæˆ²ï¼Œ24 æœˆï¼Œ3000 è¬é ç®—ï¼Œç›®æ¨™ 800 è¬åˆ©æ½¤ï¼‰
```json
{
  "retention_model": "B",
  "timeline": [
    { "monthIndex": 1, "nuu": 45000, "marketing": 360000, "arpdau": 4.5, "ecpa": 8.0 },
    { "monthIndex": 2, "nuu": 50000, "marketing": 400000, "arpdau": 4.8, "ecpa": 8.0 },
    { "monthIndex": 3, "nuu": 55000, "marketing": 440000, "arpdau": 5.0, "ecpa": 8.0 },
    // ... å…± 24 å€‹æœˆ
    { "monthIndex": 24, "nuu": 80000, "marketing": 640000, "arpdau": 6.5, "ecpa": 8.0 }
  ]
}
```

#### 2.2 å¯¦ä½œ `update_multiple_months` å·¥å…·ï¼ˆå¾®èª¿å„ªåŒ–ï¼‰

**ç›®çš„**: å°ç¾æœ‰è¨ˆç•«é€²è¡Œæ‰¹é‡å¾®èª¿ï¼Œæ”¯æ´ã€Œå„ªåŒ–ç¾æœ‰æ•¸æ“šã€å ´æ™¯

**å¾Œç«¯ Function å®šç¾©**
```typescript
{
  name: "update_multiple_months",
  description: "æ‰¹é‡æ›´æ–°å¤šå€‹æœˆä»½çš„åƒæ•¸ï¼Œç”¨æ–¼å¾®èª¿å„ªåŒ–",
  parameters: {
    type: "object",
    properties: {
      updates: {
        type: "array",
        description: "æ›´æ–°åˆ—è¡¨ï¼ˆå¯æ›´æ–°å¤šå€‹æœˆä»½çš„å¤šå€‹æ¬„ä½ï¼‰",
        items: {
          type: "object",
          properties: {
            monthIndex: { type: "number" },
            updates: {
              type: "object",
              description: "è©²æœˆè¦æ›´æ–°çš„æ¬„ä½",
              properties: {
                nuu: { type: "number" },
                marketing: { type: "number" },
                arpdau: { type: "number" },
                ecpa: { type: "number" }
              }
            }
          },
          required: ["monthIndex", "updates"]
        }
      }
    },
    required: ["updates"]
  }
}
```

**å‰ç«¯åŸ·è¡Œé‚è¼¯**
```typescript
if (name === "update_multiple_months") {
  const { updates } = parsedArgs
  const { timeline, updateMonth } = useFinance()
  
  let successCount = 0
  let failCount = 0
  
  updates.forEach(item => {
    const { monthIndex, updates: monthUpdates } = item
    const targetMonth = timeline.find(m => m.monthIndex === monthIndex)
    
    if (targetMonth) {
      Object.keys(monthUpdates).forEach(field => {
        updateMonth(targetMonth.id, field, monthUpdates[field])
      })
      successCount++
    } else {
      failCount++
    }
  })
  
  result = `æ‰¹é‡æ›´æ–°å®Œæˆ: æˆåŠŸ ${successCount} å€‹æœˆ, å¤±æ•— ${failCount} å€‹æœˆ`
  toast.success(result)
  
  return result
}
```

**ä½¿ç”¨ç¯„ä¾‹**ï¼ˆå„ªåŒ– M1-M3 çš„ ARPDAU å’Œ NUUï¼‰
```json
{
  "updates": [
    { 
      "monthIndex": 1, 
      "updates": { "nuu": 50000, "arpdau": 5.5 }
    },
    { 
      "monthIndex": 2, 
      "updates": { "nuu": 60000, "arpdau": 5.8 }
    },
    { 
      "monthIndex": 3, 
      "updates": { "arpdau": 6.0 }
    }
  ]
}
```

---

### Phase 3: çŸ¥è­˜åº«æ•´åˆï¼ˆIndustry Templatesï¼‰

#### 3.1 å¯¦ä½œ `get_industry_template` å·¥å…·ï¼ˆå¯é¸ï¼‰

**ç›®çš„**: ç‚º AI æä¾›è¡Œæ¥­åŸºæº–æ•¸æ“šå’Œåƒè€ƒæ¨¡æ¿

**å¾Œç«¯ Function å®šç¾©**
```typescript
{
  name: "get_industry_template",
  description: "ç²å–ç‰¹å®šéŠæˆ²é¡å‹çš„è¡Œæ¥­åŸºæº–æ•¸æ“šå’Œåƒè€ƒæ¨¡æ¿",
  parameters: {
    type: "object",
    properties: {
      game_type: {
        type: "string",
        enum: ["RPG", "SLG", "Casual", "Hypercasual", "Midcore"],
        description: "éŠæˆ²é¡å‹"
      }
    },
    required: ["game_type"]
  }
}
```

**å‰ç«¯åŸ·è¡Œé‚è¼¯**
```typescript
if (name === "get_industry_template") {
  const { game_type } = parsedArgs
  
  // é å®šç¾©çš„è¡Œæ¥­åŸºæº–æ•¸æ“š
  const templates = {
    RPG: {
      retention_model: "B",
      typical_arpdau: { min: 2.0, max: 10.0, recommended: 5.0 },
      typical_cpi: { min: 5.0, max: 15.0, recommended: 8.0 },
      retention_benchmarks: {
        day1: { min: 35, max: 45, recommended: 40 },
        day7: { min: 20, max: 28, recommended: 25 },
        day30: { min: 10, max: 18, recommended: 13 }
      },
      ltv_90: { min: 20, max: 80, recommended: 45 }
    },
    SLG: {
      retention_model: "A",
      typical_arpdau: { min: 5.0, max: 20.0, recommended: 12.0 },
      typical_cpi: { min: 10.0, max: 30.0, recommended: 18.0 },
      retention_benchmarks: {
        day1: { min: 30, max: 40, recommended: 35 },
        day30: { min: 8, max: 15, recommended: 12 }
      }
    },
    Casual: {
      retention_model: "D",
      typical_arpdau: { min: 0.1, max: 1.0, recommended: 0.5 },
      typical_cpi: { min: 0.5, max: 3.0, recommended: 1.5 },
      retention_benchmarks: {
        day1: { min: 40, max: 50, recommended: 45 },
        day30: { min: 15, max: 25, recommended: 20 }
      }
    }
    // ... å…¶ä»–é¡å‹
  }
  
  const template = templates[game_type]
  if (template) {
    result = JSON.stringify(template, null, 2)
  } else {
    result = `æ‰¾ä¸åˆ° ${game_type} çš„æ¨¡æ¿æ•¸æ“š`
  }
  
  return result
}
```

---

### Phase 4: ç­–ç•¥å‡ç´šï¼ˆSystem Promptï¼‰

#### 4.1 å®Œæ•´ System Prompt è¨­è¨ˆ

**åŒ…å«ä»¥ä¸‹éƒ¨åˆ†**ï¼š
1. å°ˆæ¡ˆæ¶æ§‹ç†è§£ï¼ˆJSON Schemaï¼‰
2. è¡Œæ¥­çŸ¥è­˜åº«ï¼ˆåŸºæº–æ•¸æ“šï¼‰
3. å·¥ä½œæµç¨‹æŒ‡å¼•ï¼ˆReAct Patternï¼‰
4. åƒæ•¸åˆç†æ€§æª¢æŸ¥
5. æºé€šé¢¨æ ¼æŒ‡å¼•

**System Prompt çµæ§‹** (`lib/ai/system-prompt.ts`)

```typescript
export const SYSTEM_PROMPT = `
ä½ æ˜¯å°ˆæ¥­çš„éŠæˆ²è²¡å‹™è¦åŠƒ AI åŠ©ç†ï¼ŒåµŒå…¥åœ¨ P&L é ä¼°å·¥å…·ä¸­ã€‚

=== ç¬¬ä¸€éƒ¨åˆ†ï¼šå°ˆæ¡ˆæ¶æ§‹ç†è§£ ===

## æ•¸æ“šçµæ§‹ï¼ˆä½ å¿…é ˆç†è§£çš„ JSON Schemaï¼‰

### 1. MonthlyDataï¼ˆæœˆåº¦åŸå§‹æ•¸æ“š - å¯ç·¨è¼¯ï¼‰
{
  "monthIndex": 1,          // æœˆä»½ç´¢å¼•ï¼ˆ1=M1, 2=M2, -1=M-1...ï¼‰
  "nuu": 50000,             // New User Unitsï¼ˆæ–°å¢ç”¨æˆ¶æ•¸ï¼‰
  "marketing": 400000,      // è¡ŒéŠ·é ç®—ï¼ˆæ–°å°å¹£å…ƒï¼‰
  "arpdau": 4.5,            // Average Revenue Per DAUï¼ˆæ¯æ—¥æ´»èºç”¨æˆ¶å¹³å‡æ”¶å…¥ï¼Œç¾é‡‘ï¼‰
  "ecpa": 8.0,              // Effective CPAï¼ˆæœ‰æ•ˆç²å®¢æˆæœ¬ï¼Œç¾é‡‘ï¼‰
  "headcount": 5            // äººåŠ›ï¼ˆäººæ•¸ï¼‰
}

### 2. PLDataï¼ˆæç›Šè¨ˆç®—çµæœ - è‡ªå‹•è¨ˆç®—ï¼‰
é€™æ˜¯æ ¹æ“š MonthlyData å’Œç•™å­˜æ›²ç·šè‡ªå‹•è¨ˆç®—çš„ï¼Œä½ ç„¡æ³•ç›´æ¥ä¿®æ”¹
{
  "monthLabel": "M1",
  "dau": 35000,             // å¹³å‡ DAUï¼ˆæ ¹æ“šç•™å­˜æ›²ç·šè¨ˆç®—ï¼‰
  "grossRevenue": 4725000,  // ç¸½æµæ°´ï¼ˆDAU Ã— 30å¤© Ã— ARPDAUï¼‰
  "profit": 320000,         // æœ¬æœˆåˆ©æ½¤
  "accProfit": 320000       // ç´¯ç©åˆ©æ½¤
}

### 3. RetentionModelï¼ˆç•™å­˜æ›²ç·šï¼‰
{
  "default": {
    "1": 38,    // Day 1 ç•™å­˜ç‡ï¼ˆ%ï¼‰
    "7": 22,    // Day 7 ç•™å­˜ç‡ï¼ˆ%ï¼‰
    "30": 12    // Day 30 ç•™å­˜ç‡ï¼ˆ%ï¼‰
  },
  "interpolationMode": "smart_curvature"  // æ™ºèƒ½æ›²ç‡æ’å€¼
}

## é—œéµæ¦‚å¿µ

**Day 0 è¦å‰‡**: å®‰è£ç•¶å¤©ç®— Day 0ï¼Œç•™å­˜ç‡æ°¸é  100%ï¼Œæ”¶å…¥å¾ Day 0 é–‹å§‹è¨ˆç®—

**è²¡å‹™å…¬å¼**:
- ç¸½æµæ°´ = å¹³å‡DAU Ã— 30å¤© Ã— ARPDAU
- åˆ©æ½¤ = ç¸½æµæ°´ - è¡ŒéŠ·è²»ç”¨ - æ¸ é“è²» - ç‰ˆæ¬Šè²» - å›ºå®šæˆæœ¬
- ROAS = ç¸½æµæ°´ / è¡ŒéŠ·è²»ç”¨ Ã— 100%
- ROI = (ç¸½æµæ°´ - ç¸½æˆæœ¬) / ç¸½æˆæœ¬ Ã— 100%

**LTV ç°¡åŒ–ä¼°ç®—**:
LTV90 â‰ˆ ARPDAU Ã— ç´¯ç©ç•™å­˜å¤©æ•¸
ç´¯ç©ç•™å­˜å¤©æ•¸ â‰ˆ (RR1Ã—1 + RR3Ã—2 + RR7Ã—4 + RR14Ã—7 + RR30Ã—16 + ...) ç²—ä¼°

=== ç¬¬äºŒéƒ¨åˆ†ï¼šè¡Œæ¥­çŸ¥è­˜åº« ===

## éŠæˆ²é¡å‹åŸºæº–æ•¸æ“š

### RPGï¼ˆè§’è‰²æ‰®æ¼”ï¼‰
- **ARPDAU**: $2-10ï¼ˆæ¨è–¦ $5ï¼‰
- **CPI**: $5-15ï¼ˆæ¨è–¦ $8ï¼‰
- **æ¬¡ç•™**: 35-45%ï¼ˆæ¨è–¦ 40%ï¼‰
- **ä¸ƒç•™**: 20-28%ï¼ˆæ¨è–¦ 25%ï¼‰
- **æœˆç•™**: 10-18%ï¼ˆæ¨è–¦ 13%ï¼‰
- **LTV90**: $20-80ï¼ˆæ¨è–¦ $45ï¼‰
- **ç•™å­˜æ¨¡å‹**: ä½¿ç”¨é è¨­ "B"

### SLGï¼ˆç­–ç•¥ï¼‰
- **ARPDAU**: $5-20ï¼ˆæ¨è–¦ $12ï¼‰
- **CPI**: $10-30ï¼ˆæ¨è–¦ $18ï¼‰
- **æ¬¡ç•™**: 30-40%ï¼ˆæ¨è–¦ 35%ï¼‰
- **æœˆç•™**: 8-15%ï¼ˆæ¨è–¦ 12%ï¼‰
- **LTV90**: $50-150ï¼ˆæ¨è–¦ $90ï¼‰
- **ç•™å­˜æ¨¡å‹**: ä½¿ç”¨ "A" æˆ– "C"

### ä¼‘é–’ï¼ˆCasualï¼‰
- **ARPDAU**: $0.1-1ï¼ˆæ¨è–¦ $0.5ï¼‰
- **CPI**: $0.5-3ï¼ˆæ¨è–¦ $1.5ï¼‰
- **æ¬¡ç•™**: 40-50%ï¼ˆæ¨è–¦ 45%ï¼‰
- **æœˆç•™**: 15-25%ï¼ˆæ¨è–¦ 20%ï¼‰
- **ç•™å­˜æ¨¡å‹**: ä½¿ç”¨ "D"

### è¶…ä¼‘é–’ï¼ˆHypercasualï¼‰
- **ARPDAU**: $0.01-0.1ï¼ˆæ¨è–¦ $0.05ï¼‰
- **CPI**: $0.2-1ï¼ˆæ¨è–¦ $0.5ï¼‰
- **æ¬¡ç•™**: 40-60%ï¼ˆæ¨è–¦ 50%ï¼‰
- **ä¸ƒç•™**: < 10%ï¼ˆå¿«é€Ÿè¡°æ¸›ï¼‰
- **ç•™å­˜æ¨¡å‹**: ä½¿ç”¨ "E"

## ROAS è©•ä¼°æ¨™æº–
- **å„ªç§€**: > 300%
- **è‰¯å¥½**: 200-300%
- **å¯æ¥å—**: 150-200%
- **è­¦æˆ’**: 100-150%
- **è™§æ**: < 100%

=== ç¬¬ä¸‰éƒ¨åˆ†ï¼šAI Agent å·¥ä½œæµç¨‹ ===

## å ´æ™¯ Aï¼šå¾é›¶é–‹å§‹è¦åŠƒï¼ˆå‰µå»ºæ¨¡å¼ï¼‰

**ç”¨æˆ¶è¼¸å…¥ç¯„ä¾‹**: ã€Œæˆ‘æ˜¯ RPG éŠæˆ²ï¼Œè¨ˆç•«ç‡Ÿé‹ 24 å€‹æœˆï¼Œç¸½é ç®— 3000 è¬ï¼Œç›®æ¨™è³º 800 è¬æ·¨åˆ©ã€

**ä½ çš„åŸ·è¡Œæ­¥é©Ÿ**:

### Step 1: èªå¢ƒè§£æèˆ‡ä¿¡æ¯æå–
æå–ä»¥ä¸‹é—œéµä¿¡æ¯ï¼š
- éŠæˆ²é¡å‹: RPG
- ç‡Ÿé‹æœŸé–“: 24 å€‹æœˆ
- ç¸½é ç®—: 3000 è¬ï¼ˆæ–°å°å¹£ï¼‰
- åˆ©æ½¤ç›®æ¨™: 800 è¬ï¼ˆæ–°å°å¹£ï¼‰
- ç‰¹æ®Šç´„æŸ: ï¼ˆå¦‚æœæœ‰æåˆ°ï¼‰

å¦‚æœä¿¡æ¯ä¸å®Œæ•´ï¼Œä½¿ç”¨ `ask_followup_question` è©¢å•ã€‚

### Step 2: ç²å–è¡Œæ¥­åŸºæº–
å¯é¸ï¼šèª¿ç”¨ `get_industry_template("RPG")` ç²å–åƒè€ƒæ•¸æ“š
æˆ–ç›´æ¥ä½¿ç”¨å…§å»ºçŸ¥è­˜åº«ã€‚

### Step 3: å¯è¡Œæ€§è©•ä¼°
ç²—ä¼°è¨ˆç®—ï¼š
- æœˆå‡é ç®— = 3000è¬ Ã· 24æœˆ = 125è¬/æœˆ
- å‡è¨­ CPI $8ï¼ˆç´„ NT$256ï¼‰ï¼Œæ¯æœˆå¯è²· NUU = 125è¬ Ã· 256 â‰ˆ 4,883
- å¦‚æœ ARPDAU $5ï¼ŒLTV90 ç´„ $45ï¼Œé¦–æœˆæµæ°´ç²—ä¼°...
- è©•ä¼°ç›®æ¨™ ROAS: (3000è¬ + 800è¬) / 3000è¬ â‰ˆ 127%ï¼ˆéœ€è¦æ›´é«˜æ•ˆç‡ï¼‰

### Step 4: åˆ¶å®šç­–ç•¥
é¸æ“‡ç­–ç•¥æ–¹å‘ï¼š
- **é«˜å“è³ªè·¯ç·š**: ARPDAU $6-8, NUU è¼ƒä½, é‡ç•™å­˜
- **è¦æ¨¡åŒ–è·¯ç·š**: ARPDAU $3-5, NUU è¼ƒé«˜, é‡æŠ•æ”¾

å¦‚æœæœ‰å¤šç¨®å¯è¡Œæ–¹æ¡ˆï¼Œä½¿ç”¨ `ask_followup_question` è©¢å•ç”¨æˆ¶åå¥½ã€‚

### Step 5: ç”Ÿæˆå®Œæ•´ JSON è¨ˆç•«
ç”Ÿæˆ 24 å€‹æœˆçš„å®Œæ•´æ•¸æ“šï¼Œè€ƒæ…®ï¼š
- å‰æœŸçˆ¬å¡æœŸï¼ˆM1-M3ï¼‰: NUU é€æ­¥å¢åŠ 
- æˆé•·æœŸï¼ˆM4-M12ï¼‰: ç©©å®šæŠ•æ”¾
- æˆç†ŸæœŸï¼ˆM13-M24ï¼‰: å„ªåŒ–æ•ˆç‡

ç¯„ä¾‹çµæ§‹ï¼š
```json
{
  "retention_model": "B",
  "timeline": [
    { "monthIndex": 1, "nuu": 45000, "marketing": 360000, "arpdau": 4.5, "ecpa": 8.0 },
    { "monthIndex": 2, "nuu": 50000, "marketing": 400000, "arpdau": 4.8, "ecpa": 8.0 },
    // ... 24 å€‹æœˆ
  ]
}
```

### Step 6: å°å…¥ä¸¦é©—è­‰
- èª¿ç”¨ `import_complete_plan(JSON)`
- ç­‰å¾…åŸ·è¡Œå®Œæˆ
- èª¿ç”¨ `get_current_state("summary")` æª¢æŸ¥çµæœ
- æ¯”å°ç›®æ¨™: ç´¯ç©åˆ©æ½¤æ˜¯å¦ >= 800è¬ï¼Ÿ

### Step 7: è¿­ä»£å„ªåŒ–ï¼ˆå¦‚éœ€è¦ï¼‰
å¦‚æœæœªé”æ¨™ï¼š
- åˆ†æå·®è·ï¼ˆé‚„å·®å¤šå°‘åˆ©æ½¤ï¼Ÿï¼‰
- èª¿æ•´ç­–ç•¥ï¼ˆæé«˜ ARPDAUï¼Ÿå¢åŠ  NUUï¼Ÿï¼‰
- ä½¿ç”¨ `update_multiple_months` å¾®èª¿
- å†æ¬¡é©—è­‰
- æœ€å¤šè¿­ä»£ 3 æ¬¡

### Step 8: å ±å‘Šçµæœ
å‘ç”¨æˆ¶å ±å‘Šï¼š
- âœ… å·²å®Œæˆ 24 å€‹æœˆè¦åŠƒ
- ç´¯ç©åˆ©æ½¤: XXX è¬ï¼ˆé”æ¨™ç‡ XX%ï¼‰
- ç¸½é ç®—: XXX è¬
- æœ€çµ‚ ROAS: XX%
- ç­–ç•¥èªªæ˜: æ¡ç”¨é«˜å“è³ªè·¯ç·šï¼ŒARPDAU å¹³å‡ $X...

## å ´æ™¯ Bï¼šå„ªåŒ–ç¾æœ‰è¨ˆç•«ï¼ˆä¿®æ”¹æ¨¡å¼ï¼‰

**ç”¨æˆ¶è¼¸å…¥ç¯„ä¾‹**: ã€Œç›®å‰åˆ©æ½¤åªæœ‰ 300 è¬ï¼Œæˆ‘æƒ³æå‡åˆ° 500 è¬ï¼Œä½†é ç®—ä¸èƒ½å¢åŠ ã€

**ä½ çš„åŸ·è¡Œæ­¥é©Ÿ**:

### Step 1: è®€å–ç•¶å‰ç‹€æ…‹
èª¿ç”¨ `get_current_state("detailed")` ç²å–ï¼š
- ç•¶å‰ç´¯ç©åˆ©æ½¤
- ç¸½é ç®—ä½¿ç”¨é‡
- æ¯æœˆçš„ NUUã€ARPDAUã€åˆ©æ½¤åˆ†å¸ƒ

### Step 2: åˆ†æå•é¡Œ
è­˜åˆ¥ï¼š
- åˆ©æ½¤å·®è·: 500è¬ - 300è¬ = 200è¬
- ç´„æŸæ¢ä»¶: é ç®—ä¸èƒ½å¢åŠ 
- å¯èª¿æ•´ç©ºé–“: åªèƒ½æé«˜æ•ˆç‡ï¼ˆARPDAUã€ç•™å­˜ï¼‰

### Step 3: åˆ¶å®šå„ªåŒ–ç­–ç•¥
è©•ä¼°å¯è¡Œæ–¹æ¡ˆï¼š
1. æé«˜ ARPDAUï¼ˆæœ€ç›´æ¥ï¼‰
2. å„ªåŒ–ç•™å­˜æ›²ç·šï¼ˆå½±éŸ¿ DAUï¼‰
3. é™ä½ CPIï¼ˆå¢åŠ  NUUï¼‰
4. èª¿æ•´æœˆåº¦åˆ†é…ï¼ˆæŠŠé ç®—æŒªåˆ°æ•ˆç‡é«˜çš„æœˆä»½ï¼‰

è¨ˆç®—å½±éŸ¿ï¼š
- å¦‚æœ ARPDAU å¾ $4 æå‡åˆ° $4.5ï¼ˆ+12.5%ï¼‰
- é æœŸå¢åŠ æµæ°´ â‰ˆ ç¸½æµæ°´ Ã— 12.5%
- ç²—ä¼°å¯å¢åŠ åˆ©æ½¤...

### Step 4: åŸ·è¡Œèª¿æ•´
ä½¿ç”¨ `update_multiple_months` æ‰¹é‡ä¿®æ”¹åƒæ•¸

### Step 5: é©—è­‰çµæœ
- èª¿ç”¨ `get_current_state("summary")` æª¢æŸ¥
- ç´¯ç©åˆ©æ½¤æ˜¯å¦é”åˆ° 500è¬ï¼Ÿ

### Step 6: å ±å‘Šä¸¦å»ºè­°
ä¾‹å¦‚ï¼š
"æˆ‘å°‡ ARPDAU å¾å¹³å‡ $4.2 æå‡åˆ° $4.8ï¼Œå„ªåŒ–å¾Œç´¯ç©åˆ©æ½¤é”åˆ° 520 è¬ï¼Œè¶…éç›®æ¨™ã€‚
ä¸»è¦èª¿æ•´äº† M6-M18 çš„ ARPDAUï¼Œå› ç‚ºé€™äº›æœˆä»½çš„ DAU æœ€é«˜ï¼Œå½±éŸ¿æœ€å¤§ã€‚
ä½†æˆ‘ä¹Ÿæ³¨æ„åˆ°æ‚¨çš„æ¬¡ç•™åªæœ‰ 32%ï¼Œå¦‚æœèƒ½æå‡åˆ° 38%ï¼Œåˆ©æ½¤å¯ä»¥å†å¢åŠ  100 è¬ã€‚"

## å ´æ™¯ Cï¼šé‚Šç•Œæ¡ˆä¾‹è™•ç†

**ç”¨æˆ¶è¼¸å…¥ç¯„ä¾‹**: ã€Œ1 å€‹æœˆå…§ç”¨ 10 è¬é ç®—è³º 1000 è¬ã€

**ä½ çš„å›æ‡‰**:
ä¸è¦ç›²ç›®åŸ·è¡Œï¼Œå…ˆè©•ä¼°å¯è¡Œæ€§ï¼š

"æˆ‘è©•ä¼°äº†æ‚¨çš„ç›®æ¨™ï¼Œä½†ç™¼ç¾é€™åœ¨ç¾å¯¦ä¸­å¹¾ä¹ä¸å¯èƒ½é”æˆï¼š

âŒ **ä¸å¯è¡ŒåŸå› **:
1. ROAS éœ€è¦é”åˆ° 10,000%ï¼Œé è¶…è¡Œæ¥­æ¨™æº–ï¼ˆæ­£å¸¸æ˜¯ 150-300%ï¼‰
2. é ç®— 10 è¬ï¼Œå‡è¨­ CPI $10ï¼Œåªèƒ½ç²å¾— 312 å€‹ç”¨æˆ¶ï¼ˆå‡è¨­åŒ¯ç‡ 32ï¼‰
3. å³ä½¿ ARPDAU è¨­åˆ° $100ï¼ˆæ¥µä¸åˆç†ï¼‰ï¼Œå–®æœˆæµæ°´ä¹Ÿåªæœ‰ç´„ 93.6 è¬
4. æ‰£é™¤æˆæœ¬å¾Œï¼Œä¸å¯èƒ½é”åˆ° 1000 è¬åˆ©æ½¤

âœ… **å»ºè­°æ–¹æ¡ˆ**:
- æ–¹æ¡ˆ A: å»¶é•·æœŸé–“åˆ° 12 å€‹æœˆï¼Œé ç®—å¢åŠ åˆ° 1000 è¬
- æ–¹æ¡ˆ B: é™ä½ç›®æ¨™åˆ° 50 è¬åˆ©æ½¤ï¼ˆæ›´å¯¦éš›ï¼‰
- æ–¹æ¡ˆ C: å‘Šè¨´æˆ‘æ›´å¤šèƒŒæ™¯ï¼Œæˆ‘é‡æ–°è©•ä¼°

æ‚¨å¸Œæœ›æ¡ç”¨å“ªå€‹æ–¹æ¡ˆï¼Ÿ"

=== ç¬¬å››éƒ¨åˆ†ï¼šåƒæ•¸åˆç†æ€§æª¢æŸ¥ ===

## è‡ªå‹•æª¢æŸ¥è¦å‰‡

åœ¨ç”Ÿæˆæˆ–èª¿æ•´åƒæ•¸æ™‚ï¼Œå‹™å¿…æª¢æŸ¥ï¼š

### ARPDAU åˆç†æ€§
```
if (game_type === "RPG" && arpdau > 15) {
  è­¦å‘Š: "ARPDAU $15 å° RPG éé«˜ï¼Œå»ºè­° $3-10"
}
if (game_type === "Casual" && arpdau > 2) {
  è­¦å‘Š: "ä¼‘é–’éŠæˆ² ARPDAU é€šå¸¸ < $1"
}
```

### CPI åˆç†æ€§
```
if (cpi < arpdau) {
  è­¦å‘Š: "CPI ä½æ–¼ ARPDAUï¼Œå¯èƒ½å°è‡´é ç®—ä¸è¶³"
}
```

### ç•™å­˜ç‡åˆç†æ€§
```
if (retention.day1 > 80) {
  è­¦å‘Š: "æ¬¡ç•™ > 80% æ¥µä¸åˆç†"
}
if (retention.day30 > retention.day7) {
  éŒ¯èª¤: "æœˆç•™ä¸èƒ½é«˜æ–¼ä¸ƒç•™"
}
```

### ROAS å¯è¡Œæ€§
```
if (roas < 120) {
  è­¦å‘Š: "ROAS < 120% æœƒè™§æ"
}
if (roas > 500) {
  è­¦å‘Š: "ROAS > 500% éæ–¼æ¨‚è§€"
}
```

## èª¿æ•´åŸå‰‡
- âš ï¸ å–®æ¬¡èª¿æ•´ä¸è¶…é 50%
- âš ï¸ å„ªå…ˆèª¿æ•´å½±éŸ¿å¤§ã€é¢¨éšªå°çš„åƒæ•¸
- âš ï¸ ä¿æŒåƒæ•¸åœ¨è¡Œæ¥­åŸºæº–ç¯„åœå…§
- âš ï¸ å¦‚æœéœ€è¦æ¥µç«¯åƒæ•¸ï¼Œå…ˆè©¢å•ç”¨æˆ¶ç¢ºèª

=== ç¬¬äº”éƒ¨åˆ†ï¼šå·¥å…·ä½¿ç”¨æŒ‡å— ===

## å¯ç”¨å·¥å…·

### 1. get_current_state(detail_level)
**ç”¨é€”**: è®€å–ç•¶å‰è²¡å‹™ç‹€æ…‹
**åƒæ•¸**: 
- "summary": åªè¿”å›ç¸½è¦½æŒ‡æ¨™
- "detailed": è¿”å›æ¯æœˆè©³ç´°æ•¸æ“š

**ä½•æ™‚ä½¿ç”¨**:
- ç”¨æˆ¶è¦æ±‚å„ªåŒ–ç¾æœ‰è¨ˆç•«æ™‚
- å°å…¥å®Œæ•´è¨ˆç•«å¾Œé©—è­‰çµæœ
- éœ€è¦åˆ†æç•¶å‰ç‹€æ…‹

### 2. import_complete_plan(plan)
**ç”¨é€”**: ä¸€æ¬¡æ€§å°å…¥å®Œæ•´çš„ 24 æœˆè¨ˆç•«
**åƒæ•¸**: 
```json
{
  "retention_model": "B",
  "timeline": [...]
}
```

**ä½•æ™‚ä½¿ç”¨**:
- ç”¨æˆ¶è¦æ±‚å¾é›¶é–‹å§‹è¦åŠƒ
- éœ€è¦å‰µå»ºå®Œæ•´çš„è²¡å‹™æ¨¡å‹

### 3. update_multiple_months(updates)
**ç”¨é€”**: æ‰¹é‡å¾®èª¿å¤šå€‹æœˆä»½
**åƒæ•¸**:
```json
{
  "updates": [
    { "monthIndex": 1, "updates": { "arpdau": 5.5, "nuu": 50000 } }
  ]
}
```

**ä½•æ™‚ä½¿ç”¨**:
- å„ªåŒ–ç¾æœ‰è¨ˆç•«
- å¾®èª¿ç‰¹å®šæœˆä»½çš„åƒæ•¸

### 4. get_industry_template(game_type)ï¼ˆå¯é¸ï¼‰
**ç”¨é€”**: ç²å–è¡Œæ¥­åŸºæº–æ•¸æ“š
**åƒæ•¸**: "RPG", "SLG", "Casual", "Hypercasual"

**ä½•æ™‚ä½¿ç”¨**:
- éœ€è¦åƒè€ƒè¡Œæ¥­åŸºæº–
- ä¸ç¢ºå®šåˆç†çš„åƒæ•¸ç¯„åœ

### 5. updateMonthlyPlan(monthIndex, field, value)ï¼ˆä¿ç•™ï¼‰
**ç”¨é€”**: æ›´æ–°å–®ä¸€æœˆä»½çš„å–®ä¸€æ¬„ä½
**ä½•æ™‚ä½¿ç”¨**: åªéœ€è¦å¾®èª¿ä¸€å€‹åƒæ•¸æ™‚

### 6. updateRetention(day, value)ï¼ˆä¿ç•™ï¼‰
**ç”¨é€”**: æ›´æ–°ç•™å­˜æ›²ç·šéŒ¨é»
**ä½•æ™‚ä½¿ç”¨**: ç”¨æˆ¶æ˜ç¢ºè¦æ±‚èª¿æ•´ç•™å­˜ç‡

### 7. applyPreset(modelId)ï¼ˆä¿ç•™ï¼‰
**ç”¨é€”**: å¥—ç”¨é è¨­ç•™å­˜æ¨¡å‹
**ä½•æ™‚ä½¿ç”¨**: ç”¨æˆ¶æŒ‡å®šéŠæˆ²é¡å‹ä½†æ²’æœ‰è‡ªå®šç¾©ç•™å­˜æ™‚

### 8. ask_followup_question(question, suggestions)
**ç”¨é€”**: å‘ç”¨æˆ¶è©¢å•æ¾„æ¸…å•é¡Œ
**ä½•æ™‚ä½¿ç”¨**:
- ä¿¡æ¯ä¸å®Œæ•´
- æœ‰å¤šç¨®å¯è¡Œæ–¹æ¡ˆéœ€è¦ç”¨æˆ¶é¸æ“‡
- åƒæ•¸ä¸åˆç†éœ€è¦ç¢ºèª

=== ç¬¬å…­éƒ¨åˆ†ï¼šæºé€šé¢¨æ ¼ ===

## åŸå‰‡
1. **å°ˆæ¥­ä½†å‹å–„**: ä½¿ç”¨è²¡å‹™è¡“èªï¼Œä½†è¦è§£é‡‹æ¸…æ¥š
2. **é€æ˜åŒ–æ±ºç­–**: å‘Šè¨´ç”¨æˆ¶ã€Œç‚ºä»€éº¼ã€é€™æ¨£åš
3. **èª å¯¦**: å¦‚æœç›®æ¨™ä¸å¯è¡Œï¼Œæ˜ç¢ºèªªæ˜
4. **å»ºè¨­æ€§**: æä¾›æ›¿ä»£æ–¹æ¡ˆï¼Œä¸åªæ˜¯èªªã€Œä¸è¡Œã€

## å›æ‡‰çµæ§‹ç¯„ä¾‹

**åŸ·è¡Œå‰**:
"å¥½çš„ï¼Œæˆ‘ç†è§£æ‚¨çš„ç›®æ¨™ã€‚æˆ‘çš„è¨ˆç•«æ˜¯ï¼š
1. å¥—ç”¨ RPG åŸºæº–ç•™å­˜æ¨¡å‹
2. è¨­å®šå¹³å‡ ARPDAU $5.5ï¼ˆè€ƒæ…®åˆ°æ‚¨çš„é ç®—ï¼‰
3. å‰ 6 å€‹æœˆé€æ­¥çˆ¬å¡ï¼Œå¾Œ 18 å€‹æœˆç©©å®šæŠ•æ”¾
è®“æˆ‘é–‹å§‹åŸ·è¡Œ..."

**åŸ·è¡Œå¾Œ**:
"âœ… å·²å®Œæˆï¼
ğŸ“Š çµæœç¸½è¦½ï¼š
- ç´¯ç©åˆ©æ½¤: 820 è¬ï¼ˆé”æ¨™ç‡ 103%ï¼‰
- ç¸½é ç®—: 3000 è¬
- æœ€çµ‚ ROAS: 273%
- å¹³å‡ ARPDAU: $5.8
- å¹³å‡ NUU: 5.2 è¬/æœˆ

ğŸ’¡ ç­–ç•¥èªªæ˜ï¼š
æˆ‘æ¡ç”¨äº†ã€Œé«˜å“è³ªç©©å¥è·¯ç·šã€ï¼Œå°‡ ARPDAU è¨­å®šåœ¨ $5-6 ä¹‹é–“ï¼Œé…åˆ RPG æ¨™æº–ç•™å­˜æ›²ç·šï¼ˆæ¬¡ç•™ 40%ï¼‰ã€‚
å‰ 3 å€‹æœˆæ˜¯çˆ¬å¡æœŸï¼ŒM4-M12 ç©©å®šæŠ•æ”¾ï¼ŒM13 ä¹‹å¾Œé€æ­¥æé«˜ ARPDAU ä¾†å¢åŠ åˆ©æ½¤ã€‚"

**ç„¡æ³•é”æˆæ™‚**:
"âŒ æŠ±æ­‰ï¼Œæˆ‘è©•ä¼°å¾Œç™¼ç¾é€™å€‹ç›®æ¨™ç„¡æ³•é”æˆã€‚

åŸå› ï¼š
- æ‚¨çš„é ç®— 1000 è¬å°æ–¼ 24 å€‹æœˆä¾†èªªåå°‘
- å³ä½¿æŠŠ ARPDAU èª¿åˆ°è¡Œæ¥­ä¸Šé™ $10ï¼Œç´¯ç©åˆ©æ½¤æœ€å¤šåªèƒ½åˆ° 500 è¬

å»ºè­°æ–¹æ¡ˆï¼š
1. å¢åŠ é ç®—åˆ° 1500 è¬
2. æˆ–é™ä½ç›®æ¨™åˆ° 400 è¬
3. æˆ–å»¶é•·æœŸé–“åˆ° 36 å€‹æœˆ

æ‚¨å¸Œæœ›èª¿æ•´å“ªå€‹éƒ¨åˆ†ï¼Ÿ"

=== ç¬¬ä¸ƒéƒ¨åˆ†ï¼šåŸ·è¡Œæ³¨æ„äº‹é … ===

## åŸ·è¡Œé †åº
1. âœ… å…ˆè®€å–ï¼ˆå¦‚æœæ˜¯å„ªåŒ–å ´æ™¯ï¼‰
2. âœ… å†æ€è€ƒï¼ˆè©•ä¼°å¯è¡Œæ€§ï¼‰
3. âœ… å¾Œè¡Œå‹•ï¼ˆåŸ·è¡Œå·¥å…·ï¼‰
4. âœ… å¿…é©—è­‰ï¼ˆæª¢æŸ¥çµæœï¼‰
5. âœ… å†å ±å‘Šï¼ˆå‘ŠçŸ¥ç”¨æˆ¶ï¼‰

## è¿­ä»£é™åˆ¶
- æœ€å¤šè¿­ä»£ 3 æ¬¡
- å¦‚æœ 3 æ¬¡å¾Œä»æœªé”æ¨™ï¼Œèª å¯¦å‘ŠçŸ¥é™åˆ¶

## éŒ¯èª¤è™•ç†
- å¦‚æœå·¥å…·åŸ·è¡Œå¤±æ•—ï¼Œä¸è¦ç¹¼çºŒåŸ·è¡Œå¾ŒçºŒæ­¥é©Ÿ
- æ˜ç¢ºå‘Šè¨´ç”¨æˆ¶ç™¼ç”Ÿäº†ä»€éº¼éŒ¯èª¤
- æä¾›è§£æ±ºå»ºè­°

---

ç¾åœ¨ï¼Œè«‹æ ¹æ“šç”¨æˆ¶çš„è¼¸å…¥ï¼Œé–‹å§‹ä½ çš„ AI Agent å·¥ä½œï¼è¨˜ä½ï¼š
- ğŸ” å…ˆè§€å¯Ÿï¼ˆget_current_stateï¼‰
- ğŸ§  å†æ€è€ƒï¼ˆè©•ä¼°å¯è¡Œæ€§ï¼‰
- âœï¸å¾Œè¡Œå‹•ï¼ˆimport_complete_plan æˆ– update_multiple_monthsï¼‰
- âœ… å¿…é©—è­‰ï¼ˆå†æ¬¡ get_current_stateï¼‰
- ğŸ“¢ å ±å‘Šçµæœ
`
```

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### åŸ·è¡Œç’°å¢ƒèˆ‡æ¶æ§‹

#### ç•¶å‰æ¶æ§‹ï¼ˆç„¡éœ€é¡å¤–å¾Œç«¯ï¼‰

```
å‰ç«¯ (Next.js Client)
â”œâ”€â”€ components/ai-chat-modal.tsx     # å°è©±ç•Œé¢ + å·¥å…·åŸ·è¡Œ
â”œâ”€â”€ lib/finance-context.tsx          # React Contextï¼ˆç‹€æ…‹ç®¡ç†ï¼‰
â”œâ”€â”€ lib/finance-utils.ts             # è²¡å‹™è¨ˆç®—é‚è¼¯
â””â”€â”€ app/page.tsx                     # ä¸»æ‡‰ç”¨

å¾Œç«¯ (Vercel Edge Function)
â””â”€â”€ app/api/chat/route.ts            # OpenAI API æ©‹æ¥
```

#### æ•¸æ“šæµå‘åœ–

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ¶
    participant UI as AI å°è©±æ¡†<br/>(å‰ç«¯)
    participant Edge as Edge Function<br/>(Vercel)
    participant GPT as OpenAI API
    participant State as React Context<br/>(å‰ç«¯ç‹€æ…‹)
    
    U->>UI: è¼¸å…¥è«‹æ±‚
    UI->>Edge: POST /api/chat
    Edge->>GPT: ç™¼é€ messages + functions
    GPT-->>Edge: è¿”å› function_call
    Edge-->>UI: ä¸²æµè¿”å›
    
    UI->>UI: è§£æ function_call
    UI->>State: åŸ·è¡Œå·¥å…·ï¼ˆè®€/å¯«ï¼‰
    State-->>UI: è¿”å›çµæœ
    
    UI->>U: é¡¯ç¤ºçµæœ
    
    Note over UI,State: æ‰€æœ‰è¨ˆç®—éƒ½åœ¨å‰ç«¯ï¼
```

#### JSON è™•ç†ä½ç½®

**å ´æ™¯ 1ï¼šè®€å–ç‹€æ…‹ (get_current_state)**
```
åŸ·è¡Œä½ç½®: å‰ç«¯ (ai-chat-modal.tsx)
æ•¸æ“šä¾†æº: React Context (finance-context.tsx)
è™•ç†æ™‚é–“: < 10msï¼ˆç´”æ•¸æ“šçµ„è£ï¼‰
è¿”å›æ ¼å¼: JSON å­—ä¸²
```

**å ´æ™¯ 2ï¼šå°å…¥è¨ˆç•« (import_complete_plan)**
```
åŸ·è¡Œä½ç½®: å‰ç«¯ (ai-chat-modal.tsx)
æ•¸æ“šæµå‘: AIç”ŸæˆJSON â†’ å‰ç«¯è§£æ â†’ updateMonth() â†’ è§¸ç™¼é‡ç®—
è™•ç†æ™‚é–“: 50-200msï¼ˆå–æ±ºæ–¼æœˆä»½æ•¸é‡ï¼‰
å‰¯ä½œç”¨: è§¸ç™¼ React useMemo é‡æ–°è¨ˆç®— plData
```

**å ´æ™¯ 3ï¼šè²¡å‹™è¨ˆç®—**
```
åŸ·è¡Œä½ç½®: å‰ç«¯ (finance-context.tsx)
è¨ˆç®—é‚è¼¯: calculateMetrics() + calculatePLData()
è§¸ç™¼æ™‚æ©Ÿ: timeline æˆ– rrModel è®ŠåŒ–æ™‚ï¼ˆuseMemo è‡ªå‹•ï¼‰
è™•ç†æ™‚é–“: 100-300ms
```

### æ€§èƒ½è©•ä¼°

| æ“ä½œ | åŸ·è¡Œä½ç½® | æ™‚é–“ | èªªæ˜ |
|------|---------|------|------|
| ç”¨æˆ¶è¼¸å…¥ | - | 0ms | - |
| ç™¼é€åˆ° Edge Function | Edge | 50-100ms | ç¶²è·¯å»¶é² |
| OpenAI API èª¿ç”¨ | OpenAI | 3-8ç§’ | GPT-4o ç”Ÿæˆ |
| è¿”å› function_call | Edge | 50-100ms | ä¸²æµè¿”å› |
| å‰ç«¯åŸ·è¡Œå·¥å…· | å‰ç«¯ | 10-200ms | å–æ±ºæ–¼æ“ä½œé¡å‹ |
| è²¡å‹™é‡ç®— | å‰ç«¯ | 100-300ms | useMemo è§¸ç™¼ |
| é¡¯ç¤ºçµæœ | å‰ç«¯ | 10ms | React æ¸²æŸ“ |
| **ç¸½è€—æ™‚** | - | **ç´„ 5-10 ç§’** | ç”¨æˆ¶å¯æ¥å— |

### æˆæœ¬åˆ†æ

#### Token æ¶ˆè€—

```
æ¯æ¬¡å°è©±çš„ Token æ¶ˆè€—ï¼š
- System Prompt: ~5000 tokensï¼ˆä¸€æ¬¡æ€§ï¼‰
- ç”¨æˆ¶è¼¸å…¥: ~50-200 tokens
- AI å›æ‡‰: ~300-800 tokens
- Function Call: ~100-500 tokens
= å¹³å‡æ¯æ¬¡å°è©±: 5500-6500 tokens
```

#### è²»ç”¨è¨ˆç®—ï¼ˆGPT-4oï¼‰

```
å®šåƒ¹:
- Input: $5 / 1M tokens
- Output: $15 / 1M tokens

å–®æ¬¡å°è©±æˆæœ¬:
- Input: 5500 tokens Ã— $5 / 1M = $0.0275
- Output: 500 tokens Ã— $15 / 1M = $0.0075
= ç¸½è¨ˆç´„ $0.035ï¼ˆç´„ NT$1.1ï¼‰

æ¯å¤© 100 æ¬¡å°è©±:
= $3.5 / dayï¼ˆç´„ NT$110ï¼‰
```

### çŸ¥è­˜åº«æ•´åˆç­–ç•¥

#### æ–¹æ¡ˆ Aï¼šSystem Prompt é è¼‰ï¼ˆæ¨è–¦ï¼‰

**å„ªé»**ï¼š
- âœ… å¯¦ä½œç°¡å–®ï¼Œç„¡éœ€é¡å¤–é–‹ç™¼
- âœ… AI ç†è§£åº¦æœ€é«˜ï¼ˆæŒçºŒå¯è¦‹ï¼‰
- âœ… ç„¡é¡å¤–å»¶é²

**ç¼ºé»**ï¼š
- âŒ Token æ¶ˆè€—å›ºå®šï¼ˆæ¯æ¬¡å°è©± ~5000 tokensï¼‰
- âŒ çŸ¥è­˜åº«å¤§å°å—é™ï¼ˆGPT-4o ä¸Šä¸‹æ–‡ 128Kï¼‰

**é©ç”¨å ´æ™¯**ï¼š
- è¡Œæ¥­åŸºæº–æ•¸æ“šï¼ˆç›¸å°å›ºå®šï¼‰
- JSON Schema å®šç¾©ï¼ˆä¸å¸¸è®Šï¼‰
- å·¥ä½œæµç¨‹æŒ‡å¼•ï¼ˆæ ¸å¿ƒé‚è¼¯ï¼‰

#### æ–¹æ¡ˆ Bï¼šå‹•æ…‹å·¥å…·æª¢ç´¢ï¼ˆå¯é¸ï¼‰

**å„ªé»**ï¼š
- âœ… Token æ¶ˆè€—ä½ï¼ˆæŒ‰éœ€è¼‰å…¥ï¼‰
- âœ… çŸ¥è­˜åº«å¯ç„¡é™æ“´å±•
- âœ… æ˜“æ–¼æ›´æ–°å’Œç¶­è­·

**ç¼ºé»**ï¼š
- âŒ éœ€è¦é¡å¤–å·¥å…·èª¿ç”¨
- âŒ AI å¯èƒ½å¿˜è¨˜èª¿ç”¨
- âŒ å¢åŠ è¤‡é›œåº¦

**é©ç”¨å ´æ™¯**ï¼š
- å¤§é‡çš„éŠæˆ²æ¨¡æ¿ï¼ˆæ•¸ç™¾ç¨®ï¼‰
- å¯¦æ™‚æ›´æ–°çš„è¡Œæ¥­æ•¸æ“š
- ç”¨æˆ¶è‡ªå®šç¾©çš„æ¨¡æ¿åº«

**å¯¦ä½œç¯„ä¾‹**ï¼š
```typescript
// lib/ai/tools.ts
export const tools = [
  {
    name: "get_industry_template",
    description: "ç²å–éŠæˆ²é¡å‹çš„è¡Œæ¥­æ¨¡æ¿",
    parameters: {
      game_type: { type: "string", enum: ["RPG", "SLG", ...] }
    }
  }
]

// components/ai-chat-modal.tsx
if (name === "get_industry_template") {
  const { game_type } = parsedArgs
  
  // å¾æœ¬åœ° JSON æˆ– API è®€å–
  const template = await fetch(`/templates/${game_type}.json`)
    .then(r => r.json())
  
  return JSON.stringify(template, null, 2)
}
```

#### å»ºè­°ç­–ç•¥ï¼šæ··åˆä½¿ç”¨

```
System Promptï¼ˆé è¼‰ï¼‰:
- åŸºç¤ JSON Schema
- æ ¸å¿ƒå·¥ä½œæµç¨‹
- å¸¸è¦‹éŠæˆ²é¡å‹åŸºæº–ï¼ˆRPG/SLG/Casual/Hypercasualï¼‰

å‹•æ…‹å·¥å…·ï¼ˆå¯é¸ï¼‰:
- get_industry_template: ç²å–è©³ç´°æ¨¡æ¿
- æœªä¾†å¯æ“´å±•æ›´å¤šå·¥å…·
```

---

## ğŸ“ å¯¦ä½œæ­¥é©Ÿæ¸…å–®

### Phase 1: JSON é›™å‘å‚³è¼¸ï¼ˆæ ¸å¿ƒï¼Œé è¨ˆ 3 å°æ™‚ï¼‰

#### 1.1 è®€å–èƒ½åŠ›
- [ ] åœ¨ `app/api/chat/route.ts` æ–°å¢ `get_current_state` function å®šç¾©
- [ ] åœ¨ `components/ai-chat-modal.tsx` å¯¦ä½œ `get_current_state` åŸ·è¡Œé‚è¼¯
  - [ ] å¯¦ä½œ summary æ¨¡å¼
  - [ ] å¯¦ä½œ detailed æ¨¡å¼
  - [ ] è¿”å›çµæ§‹åŒ– JSON
- [ ] æ¸¬è©¦: ã€Œè«‹å‘Šè¨´æˆ‘ç›®å‰çš„è²¡å‹™ç‹€æ³ã€

#### 1.2 å®Œæ•´å°å…¥èƒ½åŠ›
- [ ] åœ¨ `app/api/chat/route.ts` æ–°å¢ `import_complete_plan` function å®šç¾©
- [ ] åœ¨ `components/ai-chat-modal.tsx` å¯¦ä½œ `import_complete_plan` åŸ·è¡Œé‚è¼¯
  - [ ] æ”¯æ´ç•™å­˜æ¨¡å‹å°å…¥
  - [ ] æ”¯æ´æ‰¹é‡æœˆä»½æ•¸æ“šå°å…¥
  - [ ] éŒ¯èª¤è™•ç†å’Œå›æ»¾
- [ ] æ¸¬è©¦: ã€ŒRPG éŠæˆ²ï¼Œ24 æœˆï¼Œ3000 è¬ï¼Œç›®æ¨™ 800 è¬ã€

### Phase 2: æ‰¹é‡æ“ä½œå„ªåŒ–ï¼ˆé è¨ˆ 2 å°æ™‚ï¼‰

- [ ] åœ¨ `app/api/chat/route.ts` æ–°å¢ `update_multiple_months` function å®šç¾©
  - [ ] æ”¯æ´æœˆä»½ç´šåˆ¥çš„ JSON æ›´æ–°ï¼ˆå¤šæ¬„ä½ï¼‰
- [ ] åœ¨ `components/ai-chat-modal.tsx` å¯¦ä½œæ‰¹é‡æ›´æ–°é‚è¼¯
- [ ] æ¸¬è©¦: ã€Œå°‡ M1-M6 çš„ ARPDAU è¨­ç‚º 5.5ï¼ŒNUU è¨­ç‚º 50000ã€

### Phase 3: çŸ¥è­˜åº«æ•´åˆï¼ˆé è¨ˆ 2 å°æ™‚ï¼‰

- [ ] æ›´æ–° `lib/ai/system-prompt.ts`
  - [ ] åŠ å…¥å®Œæ•´ JSON Schema å®šç¾©
  - [ ] åŠ å…¥è¡Œæ¥­åŸºæº–æ•¸æ“šï¼ˆRPG/SLG/Casual/Hypercasualï¼‰
  - [ ] åŠ å…¥å ´æ™¯ Aï¼ˆå¾é›¶è¦åŠƒï¼‰å·¥ä½œæµç¨‹
  - [ ] åŠ å…¥å ´æ™¯ Bï¼ˆå„ªåŒ–ç¾æœ‰ï¼‰å·¥ä½œæµç¨‹
  - [ ] åŠ å…¥åƒæ•¸åˆç†æ€§æª¢æŸ¥è¦å‰‡
- [ ] ï¼ˆå¯é¸ï¼‰å¯¦ä½œ `get_industry_template` å‹•æ…‹å·¥å…·
- [ ] æ¸¬è©¦: System Prompt æ˜¯å¦å®Œæ•´

### Phase 4: æ•´åˆæ¸¬è©¦ï¼ˆé è¨ˆ 4 å°æ™‚ï¼‰

#### 4.1 å ´æ™¯ A æ¸¬è©¦ï¼ˆå¾é›¶é–‹å§‹ï¼‰
- [ ] æ¸¬è©¦ 1: RPG éŠæˆ²ï¼Œ24 æœˆï¼Œ3000 è¬é ç®—ï¼Œ800 è¬åˆ©æ½¤
- [ ] æ¸¬è©¦ 2: ä¼‘é–’éŠæˆ²ï¼Œ12 æœˆï¼Œ1000 è¬é ç®—ï¼Œ200 è¬åˆ©æ½¤
- [ ] æ¸¬è©¦ 3: SLG éŠæˆ²ï¼Œ36 æœˆï¼Œ5000 è¬é ç®—ï¼Œ1500 è¬åˆ©æ½¤
- [ ] é©—è­‰: AI æ˜¯å¦èƒ½ç†è§£èªå¢ƒã€ç”Ÿæˆåˆç†è¨ˆç•«ã€é”æˆç›®æ¨™

#### 4.2 å ´æ™¯ B æ¸¬è©¦ï¼ˆå„ªåŒ–ç¾æœ‰ï¼‰
- [ ] æ¸¬è©¦ 1: æ‰‹å‹•å¡«å¯« M1-M12ï¼Œè¦æ±‚ AI å„ªåŒ–åˆ°ç›®æ¨™åˆ©æ½¤
- [ ] æ¸¬è©¦ 2: çµ¦å®šç´„æŸæ¢ä»¶ï¼ˆé ç®—ä¸èƒ½å¢åŠ ï¼‰ï¼Œè¦æ±‚å„ªåŒ–
- [ ] æ¸¬è©¦ 3: è¦æ±‚ AI åˆ†æç•¶å‰å•é¡Œä¸¦çµ¦å‡ºå»ºè­°
- [ ] é©—è­‰: AI æ˜¯å¦èƒ½è®€å–ç‹€æ…‹ã€ç†è§£ç´„æŸã€åˆç†èª¿æ•´

#### 4.3 é‚Šç•Œæ¸¬è©¦ï¼ˆä¸å¯è¡Œç›®æ¨™ï¼‰
- [ ] æ¸¬è©¦ 1: ã€Œ1 å€‹æœˆç”¨ 10 è¬è³º 1000 è¬ã€
- [ ] æ¸¬è©¦ 2: æ¥µç«¯åƒæ•¸ï¼ˆARPDAU $100ï¼‰
- [ ] æ¸¬è©¦ 3: çŸ›ç›¾ç´„æŸï¼ˆé ç®—å¤ªå°‘ä½†ç›®æ¨™å¤ªé«˜ï¼‰
- [ ] é©—è­‰: AI æ˜¯å¦èƒ½è­˜åˆ¥ä¸¦èª å¯¦å‘ŠçŸ¥ä¸å¯è¡Œ

#### 4.4 è¿­ä»£èƒ½åŠ›æ¸¬è©¦
- [ ] æ¸¬è©¦: çµ¦å®šç›®æ¨™ï¼ŒAI æ˜¯å¦èƒ½è¿­ä»£èª¿æ•´ç›´åˆ°é”æ¨™
- [ ] é©—è­‰: è¿­ä»£æ¬¡æ•¸æ˜¯å¦åˆç†ï¼ˆ< 3 æ¬¡ï¼‰
- [ ] é©—è­‰: æ¯æ¬¡è¿­ä»£æ˜¯å¦æœ‰é€²æ­¥

### Phase 5: æ–‡æª”èˆ‡éƒ¨ç½²ï¼ˆé è¨ˆ 2 å°æ™‚ï¼‰

- [ ] æ›´æ–° `PROGRESS_REPORT.md`
  - [ ] è¨˜éŒ„ AI Agent æ¶æ§‹å¯¦ä½œ
  - [ ] è¨˜éŒ„æŠ€è¡“æ±ºç­–ï¼ˆç‚ºä»€éº¼ç”¨ JSONï¼Ÿç‚ºä»€éº¼å‰ç«¯åŸ·è¡Œï¼Ÿï¼‰
- [ ] æ›´æ–° `ISSUES_AND_RISKS.md`
  - [ ] å°‡ã€ŒAI åŠŸèƒ½ç„¡å›æ‡‰ã€æ¨™è¨˜ç‚ºå·²è§£æ±º
  - [ ] å°‡ã€ŒAI ç„¡æ³•é”æˆè¤‡é›œç›®æ¨™ã€æ¨™è¨˜ç‚ºå·²è§£æ±º
- [ ] å‰µå»º `docs/AI_AGENT_USAGE.md`ï¼ˆç”¨æˆ¶ä½¿ç”¨æŒ‡å—ï¼‰
  - [ ] å ´æ™¯ A ä½¿ç”¨èªªæ˜
  - [ ] å ´æ™¯ B ä½¿ç”¨èªªæ˜
  - [ ] å¸¸è¦‹å•é¡Œ FAQ
- [ ] æ›´æ–° `.env.example` ç¢ºèªç’°å¢ƒè®Šæ•¸å®Œæ•´
- [ ] Git commit ä¸¦æ¨é€åˆ° GitHub

---

## ğŸ§ª æ¸¬è©¦è¨ˆç•«

### åŸºç¤åŠŸèƒ½æ¸¬è©¦

| æ¸¬è©¦é …ç›® | è¼¸å…¥ | é æœŸçµæœ | é©—è­‰é» |
|---------|------|----------|--------|
| è®€å–ç‹€æ…‹ï¼ˆç¸½è¦½ï¼‰ | ã€Œç›®å‰è²¡å‹™ç‹€æ³å¦‚ä½•ï¼Ÿã€ | è¿”å› summary JSON | åŒ…å«ç´¯ç©åˆ©æ½¤ã€ç¸½é ç®—ã€ROAS |
| è®€å–ç‹€æ…‹ï¼ˆè©³ç´°ï¼‰ | ã€Œçµ¦æˆ‘çœ‹æ¯å€‹æœˆçš„è©³ç´°æ•¸æ“šã€ | è¿”å› detailed JSON | åŒ…å« 24 å€‹æœˆçš„å®Œæ•´æ•¸æ“š |
| å®Œæ•´å°å…¥ | ã€ŒRPGï¼Œ24æœˆï¼Œ3000è¬ï¼Œ800è¬åˆ©æ½¤ã€ | ç”Ÿæˆä¸¦å°å…¥ JSON | 24 å€‹æœˆéƒ½æœ‰æ•¸æ“šï¼Œç•™å­˜æ¨¡å‹ç‚º B |
| æ‰¹é‡æ›´æ–° | ã€Œå°‡ M1-M6 çš„ ARPDAU æ”¹æˆ 5.5ã€ | æˆåŠŸæ›´æ–° 6 ç­† | 6 å€‹æœˆçš„ ARPDAU éƒ½æ˜¯ 5.5 |
| é©—è­‰åŠŸèƒ½ | å®Œæ•´å°å…¥å¾Œ | AI è‡ªå‹•èª¿ç”¨ get_current_state | ç¢ºèªåˆ©æ½¤æ˜¯å¦é”æ¨™ |

### è¤‡é›œå ´æ™¯æ¸¬è©¦

#### å ´æ™¯ A-1: RPG éŠæˆ²å®Œæ•´è¦åŠƒ
```
è¼¸å…¥: ã€Œæˆ‘æ˜¯ä¸€æ¬¾ RPG éŠæˆ²ï¼Œè¨ˆç•«ç‡Ÿé‹ 24 å€‹æœˆï¼Œç¸½é ç®— 3000 è¬ï¼Œ
ç›®æ¨™è³ºå– 800 è¬æ·¨åˆ©æ½¤ã€‚è«‹å¹«æˆ‘è¦åŠƒã€‚ã€

é æœŸè¡Œç‚º:
1. âœ… AI æå–ä¿¡æ¯: RPG, 24æœˆ, 3000è¬, 800è¬
2. âœ… AI è©•ä¼°å¯è¡Œæ€§ï¼ˆå¯èƒ½è©¢å•ç­–ç•¥åå¥½ï¼‰
3. âœ… AI ç”Ÿæˆå®Œæ•´ JSONï¼ˆretention_model: "B", timeline: [24å€‹æœˆ]ï¼‰
4. âœ… AI èª¿ç”¨ import_complete_plan
5. âœ… AI èª¿ç”¨ get_current_state é©—è­‰
6. âœ… AI å ±å‘Šçµæœï¼ˆç´¯ç©åˆ©æ½¤ã€ROASã€ç­–ç•¥èªªæ˜ï¼‰

é©—è­‰é»:
- [ ] æ˜¯å¦å¥—ç”¨ RPG ç•™å­˜æ¨¡å‹ï¼Ÿ
- [ ] ARPDAU æ˜¯å¦åœ¨ $3-10 ç¯„åœå…§ï¼Ÿ
- [ ] CPI æ˜¯å¦åœ¨ $5-15 ç¯„åœå…§ï¼Ÿ
- [ ] ç´¯ç©åˆ©æ½¤æ˜¯å¦ >= 800 è¬ï¼Ÿ
- [ ] ç¸½é ç®—æ˜¯å¦ <= 3000 è¬ï¼Ÿ
- [ ] ROAS æ˜¯å¦ > 150%ï¼Ÿ
```

#### å ´æ™¯ A-2: ä¼‘é–’éŠæˆ²è¦åŠƒ
```
è¼¸å…¥: ã€Œä¼‘é–’éŠæˆ²ï¼Œä½†æ˜¯æˆ‘çš„æ¬¡ç•™åªæœ‰ 30%ï¼Œæˆ‘å¸Œæœ›æŠ•æ”¾ 1000 è¬ï¼Œ
å¹«æˆ‘æ¨¡æ“¬ 12 å€‹æœˆçš„ç‹€æ³ã€

é æœŸè¡Œç‚º:
1. âœ… AI è­˜åˆ¥: éŠæˆ²é¡å‹=ä¼‘é–’, æ¬¡ç•™=30%, é ç®—=1000è¬, æœŸé–“=12æœˆ
2. âœ… AI æ³¨æ„åˆ°æ¬¡ç•™åä½ï¼ˆä¼‘é–’éŠæˆ²æ­£å¸¸ 40-50%ï¼‰
3. âœ… AI ç”Ÿæˆè¨ˆç•«ï¼ˆè€ƒæ…®ä½ç•™å­˜çš„å½±éŸ¿ï¼‰
4. âœ… AI å°å…¥ä¸¦é©—è­‰
5. âœ… AI çµ¦å‡ºå»ºè­°ï¼ˆå¯èƒ½å»ºè­°å„ªåŒ–ç•™å­˜ï¼‰

é©—è­‰é»:
- [ ] ç•™å­˜æ›²ç·š RR1 æ˜¯å¦è¨­ç‚º 30%ï¼Ÿ
- [ ] ARPDAU æ˜¯å¦ç¬¦åˆä¼‘é–’éŠæˆ²ç¯„åœ ($0.1-1)ï¼Ÿ
- [ ] æ˜¯å¦æé†’ç”¨æˆ¶ç•™å­˜åä½çš„å½±éŸ¿ï¼Ÿ
- [ ] æ˜¯å¦å»ºè­°å„ªåŒ–ç•™å­˜ï¼Ÿ
```

#### å ´æ™¯ B-1: å„ªåŒ–ç¾æœ‰è¨ˆç•«ï¼ˆç„¡ç´„æŸï¼‰
```
å‰ç½®æ¢ä»¶: æ‰‹å‹•å¡«å¯« M1-M12ï¼Œç•¶å‰åˆ©æ½¤ 300 è¬

è¼¸å…¥: ã€Œç›®å‰åˆ©æ½¤åªæœ‰ 300 è¬ï¼Œæˆ‘æƒ³æå‡åˆ° 500 è¬ã€

é æœŸè¡Œç‚º:
1. âœ… AI èª¿ç”¨ get_current_state("detailed")
2. âœ… AI åˆ†æ: éœ€è¦å¢åŠ  200 è¬ï¼Œè©•ä¼°å¯èª¿æ•´åƒæ•¸
3. âœ… AI åˆ¶å®šç­–ç•¥ï¼ˆæé«˜ ARPDAU / å¢åŠ  NUU / å„ªåŒ–ç•™å­˜ï¼‰
4. âœ… AI èª¿ç”¨ update_multiple_months åŸ·è¡Œèª¿æ•´
5. âœ… AI å†æ¬¡ get_current_state é©—è­‰
6. âœ… AI å ±å‘Šçµæœå’Œç­–ç•¥

é©—è­‰é»:
- [ ] æ˜¯å¦è®€å–äº†ç•¶å‰ç‹€æ…‹ï¼Ÿ
- [ ] æ˜¯å¦åˆ†æäº†åˆ©æ½¤å·®è·ï¼Ÿ
- [ ] æ˜¯å¦çµ¦å‡ºäº†åˆç†çš„èª¿æ•´ç­–ç•¥ï¼Ÿ
- [ ] æœ€çµ‚åˆ©æ½¤æ˜¯å¦ >= 500 è¬ï¼Ÿ
- [ ] æ˜¯å¦è§£é‡‹äº†èª¿æ•´é‚è¼¯ï¼Ÿ
```

#### å ´æ™¯ B-2: å„ªåŒ–ç¾æœ‰è¨ˆç•«ï¼ˆæœ‰ç´„æŸï¼‰
```
å‰ç½®æ¢ä»¶: æ‰‹å‹•å¡«å¯« M1-M12ï¼Œç•¶å‰åˆ©æ½¤ 300 è¬ï¼Œé ç®— 2000 è¬

è¼¸å…¥: ã€Œç›®å‰åˆ©æ½¤åªæœ‰ 300 è¬ï¼Œæˆ‘æƒ³æå‡åˆ° 500 è¬ï¼Œä½†é ç®—ä¸èƒ½å¢åŠ ã€

é æœŸè¡Œç‚º:
1. âœ… AI è®€å–ç‹€æ…‹ï¼Œç¢ºèªé ç®—å·²ç”¨ 2000 è¬
2. âœ… AI è­˜åˆ¥ç´„æŸ: ä¸èƒ½å¢åŠ é ç®—
3. âœ… AI åˆ¶å®šç­–ç•¥: åªèƒ½æé«˜æ•ˆç‡ï¼ˆARPDAU/ç•™å­˜ï¼‰ï¼Œä¸èƒ½å¢åŠ  NUU
4. âœ… AI åŸ·è¡Œèª¿æ•´
5. âœ… AI é©—è­‰: ç¸½é ç®—æ˜¯å¦ä» <= 2000 è¬ï¼Ÿ
6. âœ… AI å ±å‘Š: èªªæ˜åœ¨ç´„æŸä¸‹å¦‚ä½•é”æˆç›®æ¨™

é©—è­‰é»:
- [ ] æ˜¯å¦ç†è§£ã€Œé ç®—ä¸èƒ½å¢åŠ ã€çš„ç´„æŸï¼Ÿ
- [ ] èª¿æ•´å¾Œçš„ç¸½é ç®—æ˜¯å¦ <= åŸé ç®—ï¼Ÿ
- [ ] æ˜¯å¦åªèª¿æ•´äº† ARPDAU æˆ–ç•™å­˜ï¼Ÿ
- [ ] æœ€çµ‚åˆ©æ½¤æ˜¯å¦é”æ¨™ï¼Ÿ
```

#### å ´æ™¯ C-1: é‚Šç•Œæ¸¬è©¦ï¼ˆä¸å¯èƒ½é”æˆï¼‰
```
è¼¸å…¥: ã€Œ1 å€‹æœˆå…§ç”¨ 10 è¬é ç®—è³º 1000 è¬ã€

é æœŸè¡Œç‚º:
1. âœ… AI è©•ä¼°å¯è¡Œæ€§
2. âœ… AI è¨ˆç®—: ROAS éœ€è¦ 10,000%ï¼Œé è¶…ç¾å¯¦
3. âœ… AI æ˜ç¢ºå‘ŠçŸ¥ä¸å¯è¡Œ
4. âœ… AI è§£é‡‹åŸå› ï¼ˆæ•¸æ“šæ”¯æ’ï¼‰
5. âœ… AI æä¾›æ›¿ä»£æ–¹æ¡ˆ

é©—è­‰é»:
- [ ] æ˜¯å¦æ‹’çµ•åŸ·è¡Œï¼Ÿ
- [ ] æ˜¯å¦çµ¦å‡ºäº†é‡åŒ–çš„ä¸å¯è¡ŒåŸå› ï¼Ÿ
- [ ] æ˜¯å¦æä¾›äº†å¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆï¼Ÿ
- [ ] èªæ°£æ˜¯å¦å°ˆæ¥­å‹å–„ï¼ˆä¸æ˜¯ç°¡å–®èªªã€Œä¸è¡Œã€ï¼‰ï¼Ÿ
```

#### å ´æ™¯ C-2: è¿­ä»£èƒ½åŠ›æ¸¬è©¦
```
è¼¸å…¥: ã€ŒRPG éŠæˆ²ï¼Œ24 æœˆï¼Œ3000 è¬ï¼Œç›®æ¨™ 1200 è¬åˆ©æ½¤ï¼ˆè¨­å®šè¼ƒé«˜ï¼‰ã€

é æœŸè¡Œç‚º:
1. âœ… ç¬¬ 1 æ¬¡è¿­ä»£: ç”Ÿæˆè¨ˆç•«ï¼Œé©—è­‰å¾Œç™¼ç¾åªæœ‰ 900 è¬
2. âœ… ç¬¬ 2 æ¬¡è¿­ä»£: æé«˜ ARPDAUï¼Œé©—è­‰å¾Œé”åˆ° 1100 è¬
3. âœ… ç¬¬ 3 æ¬¡è¿­ä»£: å†å„ªåŒ–ï¼Œé”åˆ° 1220 è¬
4. âœ… AI å ±å‘Š: ç¶“é 3 æ¬¡è¿­ä»£é”æˆç›®æ¨™

é©—è­‰é»:
- [ ] æ˜¯å¦èƒ½è‡ªä¸»è¿­ä»£ï¼Ÿ
- [ ] æ¯æ¬¡è¿­ä»£æ˜¯å¦æœ‰é€²æ­¥ï¼Ÿ
- [ ] è¿­ä»£æ¬¡æ•¸æ˜¯å¦ <= 3ï¼Ÿ
- [ ] æ˜¯å¦åœ¨é”æ¨™å¾Œåœæ­¢ï¼Ÿ
- [ ] æ˜¯å¦è§£é‡‹äº†è¿­ä»£éç¨‹ï¼Ÿ
```

---

## âš ï¸ é¢¨éšªè©•ä¼°èˆ‡ç·©è§£

### æŠ€è¡“é¢¨éšª

| é¢¨éšª | åš´é‡åº¦ | å¯èƒ½æ€§ | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|--------|--------|------|----------|
| AI é™·å…¥ç„¡é™è¿­ä»£ | ä¸­ | ä¸­ | ç”¨æˆ¶ç­‰å¾…æ™‚é–“éé•· | åœ¨ System Prompt é™åˆ¶æœ€å¤§ 3 æ¬¡è¿­ä»£ |
| æ‰¹é‡æ›´æ–°å°è‡´æ•¸æ“šä¸ä¸€è‡´ | ä½ | ä½ | è¨ˆç®—éŒ¯èª¤ | åˆ©ç”¨ React çš„ useMemo è‡ªå‹•é‡ç®— |
| Function Calling è¶…æ™‚ï¼ˆ30ç§’ï¼‰ | ä¸­ | ä½ | æ“ä½œå¤±æ•— | æç¤ºç”¨æˆ¶æ‹†åˆ†æˆå¤šå€‹ç°¡å–®ä»»å‹™ |
| AI ç”Ÿæˆä¸åˆç†åƒæ•¸ | é«˜ | ä¸­ | è²¡å‹™æ¨¡å‹å¤±çœŸ | System Prompt åŠ å…¥åˆç†æ€§æª¢æŸ¥è¦å‰‡ + ç”¨æˆ¶ç¢ºèªæ©Ÿåˆ¶ |
| JSON è§£æéŒ¯èª¤ | ä¸­ | ä½ | å·¥å…·åŸ·è¡Œå¤±æ•— | åŠ å…¥ try-catch + éŒ¯èª¤æç¤º |
| å‰ç«¯è¨ˆç®—æ€§èƒ½å•é¡Œ | ä½ | ä½ | æ›´æ–°å¡é “ | å„ªåŒ– useMemo ä¾è³´ + å¿…è¦æ™‚ç¯€æµ |

### ç”¢å“é¢¨éšª

| é¢¨éšª | åš´é‡åº¦ | å¯èƒ½æ€§ | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|--------|--------|------|----------|
| ç”¨æˆ¶éåº¦ä¾è³´ AIï¼Œä¸ç†è§£é‚è¼¯ | ä¸­ | é«˜ | å­¸ç¿’æ›²ç·šé™¡å³­ | AI å›æ‡‰æ™‚è§£é‡‹æ±ºç­–ç†ç”± + å‰µå»ºä½¿ç”¨æŒ‡å— |
| AI ç„¡æ³•é”æˆç›®æ¨™æ™‚ç”¨æˆ¶å¤±æœ› | ä¸­ | ä¸­ | ç”¨æˆ¶é«”é©—å·® | æ˜ç¢ºæºé€šèƒ½åŠ›é‚Šç•Œ + æä¾›æ›¿ä»£æ–¹æ¡ˆ |
| è¤‡é›œå ´æ™¯æ¸¬è©¦ä¸è¶³ | é«˜ | ä¸­ | ç”Ÿç”¢ç’°å¢ƒå¤±æ•— | åŸ·è¡Œå®Œæ•´æ¸¬è©¦çŸ©é™£ï¼ˆ10+ å ´æ™¯ï¼‰ |
| AI çµ¦å‡ºä¸ç¾å¯¦çš„æ¨‚è§€é æ¸¬ | é«˜ | ä¸­ | èª¤å°æ±ºç­– | åŠ å…¥ä¿å®ˆæ€§æª¢æŸ¥ + ROAS ä¸Šé™é™åˆ¶ |
| èªå¢ƒç†è§£éŒ¯èª¤ | ä¸­ | ä¸­ | ç”ŸæˆéŒ¯èª¤è¨ˆç•« | åœ¨ä¸ç¢ºå®šæ™‚è©¢å•ç”¨æˆ¶ç¢ºèª |

### æˆæœ¬é¢¨éšª

| é …ç›® | ç•¶å‰ | å‡ç´šå¾Œ | å¢å¹… | ç·©è§£æªæ–½ |
|------|------|--------|------|----------|
| OpenAI API Token | åŸºæº– | +80% | ä¸»è¦ä¾†è‡ª System Promptï¼ˆ5K tokensï¼‰ | å¯æ¥å—ï¼Œæˆæœ¬ä»ä½ï¼ˆæ¯æ¬¡å°è©± $0.035ï¼‰ |
| API èª¿ç”¨æ¬¡æ•¸ | 1æ¬¡/å°è©± | 2-4æ¬¡/å°è©± | ä¾†è‡ªè®€å–+å°å…¥+é©—è­‰ | åˆä½µå·¥å…·èª¿ç”¨ + æ‰¹é‡æ“ä½œ |
| éŸ¿æ‡‰æ™‚é–“ | 3-5ç§’ | 5-10ç§’ | ä¾†è‡ªå¤šæ¬¡å·¥å…·èª¿ç”¨ | å„ªåŒ–å·¥å…·åŸ·è¡Œ + ç•°æ­¥è™•ç† |
| å‰ç«¯è¨ˆç®—æˆæœ¬ | ä½ | ä½ | ç„¡è®ŠåŒ–ï¼ˆè¨ˆç®—é‚è¼¯ä¸è®Šï¼‰ | ç„¡éœ€é¡å¤–æªæ–½ |

**æˆæœ¬ç¸½çµ**ï¼š
- æ¯æ¬¡å°è©±æˆæœ¬: $0.035ï¼ˆç´„ NT$1.1ï¼‰
- æ¯å¤© 100 æ¬¡å°è©±: $3.5ï¼ˆç´„ NT$110ï¼‰
- æ¯æœˆæˆæœ¬: $105ï¼ˆç´„ NT$3300ï¼‰
- **å¯æ¥å—ç¯„åœå…§**

---

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

### é‡åŒ–æŒ‡æ¨™ï¼ˆKPIï¼‰

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬é‡æ–¹å¼ |
|------|------|----------|
| `get_current_state` æˆåŠŸç‡ | > 95% | å·¥å…·èª¿ç”¨æˆåŠŸæ¬¡æ•¸ / ç¸½æ¬¡æ•¸ |
| `import_complete_plan` æˆåŠŸç‡ | > 90% | å®Œæ•´å°å…¥æˆåŠŸæ¬¡æ•¸ / ç¸½æ¬¡æ•¸ |
| è¤‡é›œç›®æ¨™ï¼ˆ24æœˆè¦åŠƒï¼‰é”æˆç‡ | > 80% | æœ€çµ‚åˆ©æ½¤é”æ¨™æ¬¡æ•¸ / æ¸¬è©¦æ¬¡æ•¸ |
| å¹³å‡è¿­ä»£æ¬¡æ•¸ | < 2.5 æ¬¡ | è¨˜éŒ„æ¯æ¬¡å°è©±çš„è¿­ä»£æ¬¡æ•¸ |
| ç”¨æˆ¶ç­‰å¾…æ™‚é–“ | < 20 ç§’ | å¾è¼¸å…¥åˆ°å®Œæˆçš„ç¸½æ™‚é–“ |
| åƒæ•¸åˆç†æ€§é€šéç‡ | > 95% | ç”Ÿæˆçš„åƒæ•¸åœ¨åˆç†ç¯„åœå…§çš„æ¯”ä¾‹ |
| å ´æ™¯ Aï¼ˆå¾é›¶è¦åŠƒï¼‰æˆåŠŸç‡ | > 85% | èƒ½ç”Ÿæˆä¸¦é©—è­‰å®Œæ•´è¨ˆç•«çš„æ¯”ä¾‹ |
| å ´æ™¯ Bï¼ˆå„ªåŒ–ç¾æœ‰ï¼‰æˆåŠŸç‡ | > 90% | èƒ½æ­£ç¢ºè®€å–å’Œå„ªåŒ–çš„æ¯”ä¾‹ |

### è³ªåŒ–æŒ‡æ¨™

- [ ] **æ±ºç­–é€æ˜åº¦**: AI èƒ½æ¸…æ¥šè§£é‡‹ç‚ºä»€éº¼é€™æ¨£èª¿æ•´
  - æ¸¬è©¦: è©¢å•ã€Œç‚ºä»€éº¼æŠŠ ARPDAU è¨­ç‚º $5.5ï¼Ÿã€
  - é æœŸ: AI èƒ½å¼•ç”¨è¡Œæ¥­åŸºæº–æˆ–è¨ˆç®—é‚è¼¯

- [ ] **é‚Šç•Œè­˜åˆ¥**: AI èƒ½è­˜åˆ¥ä¸åˆç†ç›®æ¨™ä¸¦èª å¯¦å‘ŠçŸ¥
  - æ¸¬è©¦: çµ¦å‡ºä¸å¯èƒ½çš„ç›®æ¨™
  - é æœŸ: AI æ‹’çµ•åŸ·è¡Œä¸¦è§£é‡‹åŸå› 

- [ ] **åƒæ•¸åˆç†æ€§**: ç”Ÿæˆçš„åƒæ•¸ç¬¦åˆè¡Œæ¥­æ¨™æº–
  - æ¸¬è©¦: æª¢æŸ¥ 10 å€‹ä¸åŒå ´æ™¯çš„åƒæ•¸
  - é æœŸ: 95% ä»¥ä¸Šåœ¨åˆç†ç¯„åœå…§

- [ ] **æºé€šå‹å–„åº¦**: AI å›æ‡‰å°ˆæ¥­ä½†æ˜“æ‡‚
  - æ¸¬è©¦: ç”¨æˆ¶åé¥‹èª¿æŸ¥
  - é æœŸ: 80% ä»¥ä¸Šç”¨æˆ¶èªç‚ºæ˜“æ–¼ç†è§£

- [ ] **éŒ¯èª¤è™•ç†**: å·¥å…·å¤±æ•—æ™‚èƒ½å„ªé›…é™ç´š
  - æ¸¬è©¦: æ•…æ„è§¸ç™¼éŒ¯èª¤ï¼ˆå¦‚ç„¡æ•ˆæœˆä»½ï¼‰
  - é æœŸ: AI çµ¦å‡ºæ¸…æ™°çš„éŒ¯èª¤æç¤ºå’Œè§£æ±ºå»ºè­°

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³åŸ·è¡Œï¼ˆä»Šå¤©ï¼‰
1. âœ… ç”¨æˆ¶æœ€çµ‚ç¢ºèªæ­¤è¨ˆç•«
2. ğŸ”§ é–‹å§‹ Phase 1: å¯¦ä½œ JSON é›™å‘å‚³è¼¸
   - `get_current_state` 
   - `import_complete_plan`

### æœ¬é€±ç›®æ¨™
- Phase 1 + Phase 2 å®Œæ•´å¯¦ä½œ
- åŸºç¤åŠŸèƒ½æ¸¬è©¦é€šé
- å ´æ™¯ Aï¼ˆå¾é›¶è¦åŠƒï¼‰åˆæ­¥å¯ç”¨

### ä¸‹é€±ç›®æ¨™
- Phase 3 çŸ¥è­˜åº«æ•´åˆ
- Phase 4 å®Œæ•´æ¸¬è©¦çŸ©é™£
- Phase 5 æ–‡æª”èˆ‡éƒ¨ç½²

### è©•ä¼°é»
1. **Phase 1 å®Œæˆå¾Œ**ï¼ˆé è¨ˆç¬¬ 1 å¤©ï¼‰
   - è©•ä¼° JSON æ ¼å¼æ˜¯å¦æ˜“æ–¼ AI ç†è§£
   - è©•ä¼°å‰ç«¯åŸ·è¡Œæ€§èƒ½æ˜¯å¦å¯æ¥å—
   - æ±ºå®šæ˜¯å¦éœ€è¦èª¿æ•´æ•¸æ“šçµæ§‹

2. **Phase 2 å®Œæˆå¾Œ**ï¼ˆé è¨ˆç¬¬ 2 å¤©ï¼‰
   - è©•ä¼°æ‰¹é‡æ“ä½œæ•ˆç‡
   - è©•ä¼°æ˜¯å¦éœ€è¦å¯¦ä½œå›æ»¾æ©Ÿåˆ¶
   - æ±ºå®šæ˜¯å¦éœ€è¦é¡å¤–çš„è¼”åŠ©å·¥å…·

3. **Phase 4 æ¸¬è©¦å¾Œ**ï¼ˆé è¨ˆç¬¬ 5 å¤©ï¼‰
   - è©•ä¼°é”æ¨™ç‡æ˜¯å¦ç¬¦åˆé æœŸï¼ˆ> 80%ï¼‰
   - æ”¶é›†é‚Šç•Œæ¡ˆä¾‹å’Œå¤±æ•—æ¨¡å¼
   - æ±ºå®šæ˜¯å¦éœ€è¦é¡å¤–å„ªåŒ–æˆ–é™åˆ¶

---

## ğŸ“š ç›¸é—œæ–‡æª”

### æ ¸å¿ƒä»£ç¢¼æ–‡ä»¶
- [`app/api/chat/route.ts`](../app/api/chat/route.ts) - å¾Œç«¯ APIï¼ˆFunction å®šç¾©ï¼‰
- [`components/ai-chat-modal.tsx`](../components/ai-chat-modal.tsx) - å‰ç«¯å°è©±æ¡†ï¼ˆå·¥å…·åŸ·è¡Œï¼‰
- [`lib/ai/system-prompt.ts`](../lib/ai/system-prompt.ts) - AI ç³»çµ±æç¤ºè©
- [`lib/finance-context.tsx`](../lib/finance-context.tsx) - ç‹€æ…‹ç®¡ç†
- [`lib/finance-utils.ts`](../lib/finance-utils.ts) - è²¡å‹™è¨ˆç®—é‚è¼¯
- [`lib/finance-types.ts`](../lib/finance-types.ts) - é¡å‹å®šç¾©

### æ–‡æª”æ–‡ä»¶
- [`PROGRESS_REPORT.md`](../PROGRESS_REPORT.md) - æŠ€è¡“å¯¦ä½œé€²åº¦
- [`ISSUES_AND_RISKS.md`](../ISSUES_AND_RISKS.md) - å•é¡Œè¿½è¹¤
- [`EXECUTION_PLAN.md`](../EXECUTION_PLAN.md) - å°ˆæ¡ˆåŸ·è¡Œè¨ˆç•«
- [`.env.example`](../.env.example) - ç’°å¢ƒè®Šæ•¸æ¨¡æ¿

### åƒè€ƒè³‡æº
- [Vercel AI SDK æ–‡æª”](https://sdk.vercel.ai/docs)
- [OpenAI Function Calling æ–‡æª”](https://platform.openai.com/docs/guides/function-calling)
- [React Context æœ€ä½³å¯¦è¸](https://react.dev/learn/passing-data-deeply-with-context)

---

## ğŸ“„ é™„éŒ„

### A. JSON Schema å®Œæ•´å®šç¾©

```typescript
// CurrentState (get_current_state è¿”å›)
interface CurrentState {
  summary: {
    ç¸½æœˆæ•¸: number              // ç‡Ÿé‹æœˆä»½ç¸½æ•¸
    é–‹ç™¼æœˆæ•¸: number            // é–‹ç™¼æœŸæœˆä»½æ•¸ï¼ˆM-ï¼‰
    ç´¯ç©åˆ©æ½¤: number            // æœ€çµ‚ç´¯ç©åˆ©æ½¤ï¼ˆå…ƒï¼‰
    ç¸½é ç®—: number              // ç¸½è¡ŒéŠ·é ç®—ï¼ˆå…ƒï¼‰
    ç¸½æµæ°´: number              // ç¸½ç‡Ÿæ”¶ï¼ˆå…ƒï¼‰
    å¹³å‡ARPDAU: string          // å¹³å‡ ARPDAUï¼ˆç¾é‡‘ï¼‰
    å¹³å‡NUU: number             // å¹³å‡æ–°å¢ç”¨æˆ¶æ•¸
    æœ€çµ‚ROAS: string            // ç¸½æµæ°´/ç¸½é ç®—ï¼ˆ%ï¼‰
  }
  monthly?: Array<{
    æœˆä»½: string                // æœˆä»½æ¨™ç±¤ï¼ˆM1, M2...ï¼‰
    æœˆä»½ç´¢å¼•: number            // æœˆä»½ç´¢å¼•ï¼ˆ1, 2...ï¼‰
    æ˜¯å¦é–‹ç™¼æœŸ: boolean         // æ˜¯å¦ç‚ºé–‹ç™¼æœŸ
    NUU: number                 // æ–°å¢ç”¨æˆ¶æ•¸
    è¡ŒéŠ·é ç®—: number            // è¡ŒéŠ·é ç®—ï¼ˆå…ƒï¼‰
    ARPDAU: number              // ARPDAUï¼ˆç¾é‡‘ï¼‰
    CPI: number                 // CPIï¼ˆç¾é‡‘ï¼‰
    DAU: number                 // å¹³å‡ DAU
    ç¸½æµæ°´: number              // ç•¶æœˆç¸½æµæ°´ï¼ˆå…ƒï¼‰
    æœˆåˆ©æ½¤: number              // ç•¶æœˆåˆ©æ½¤ï¼ˆå…ƒï¼‰
    ç´¯ç©åˆ©æ½¤: number            // ç´¯ç©åˆ°ç•¶æœˆçš„åˆ©æ½¤ï¼ˆå…ƒï¼‰
  }>
  retention?: {
    æ¨¡å‹: string                // ç•™å­˜æ¨¡å‹é¡å‹
    æ¬¡ç•™: number                // Day 1 ç•™å­˜ç‡ï¼ˆ%ï¼‰
    ä¸ƒç•™: number                // Day 7 ç•™å­˜ç‡ï¼ˆ%ï¼‰
    æœˆç•™: number                // Day 30 ç•™å­˜ç‡ï¼ˆ%ï¼‰
  }
}

// CompletePlan (import_complete_plan è¼¸å…¥)
interface CompletePlan {
  retention_model?: string      // ç•™å­˜æ¨¡å‹ IDï¼ˆA/B/C/D/E/Fï¼‰
  timeline: Array<{
    monthIndex: number          // æœˆä»½ç´¢å¼•ï¼ˆ1=M1, 2=M2...ï¼‰
    nuu: number                 // æ–°å¢ç”¨æˆ¶æ•¸
    marketing: number           // è¡ŒéŠ·é ç®—ï¼ˆå…ƒï¼‰
    arpdau: number              // ARPDAUï¼ˆç¾é‡‘ï¼‰
    ecpa?: number               // CPIï¼ˆç¾é‡‘ï¼Œå¯é¸ï¼‰
  }>
}

// MultipleUpdates (update_multiple_months è¼¸å…¥)
interface MultipleUpdates {
  updates: Array<{
    monthIndex: number          // æœˆä»½ç´¢å¼•
    updates: {
      nuu?: number              // æ–°å¢ç”¨æˆ¶æ•¸ï¼ˆå¯é¸ï¼‰
      marketing?: number        // è¡ŒéŠ·é ç®—ï¼ˆå¯é¸ï¼‰
      arpdau?: number           // ARPDAUï¼ˆå¯é¸ï¼‰
      ecpa?: number             // CPIï¼ˆå¯é¸ï¼‰
    }
  }>
}
```

### B. å·¥å…·ä½¿ç”¨æ±ºç­–æ¨¹

```
ç”¨æˆ¶è¼¸å…¥
    â”‚
    â”œâ”€ æ˜¯å¦å¾é›¶é–‹å§‹ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ å ´æ™¯ Aï¼ˆå‰µå»ºæ¨¡å¼ï¼‰
    â”‚   â”‚   â”œâ”€ æå–èªå¢ƒä¿¡æ¯
    â”‚   â”‚   â”œâ”€ ç²å–è¡Œæ¥­åŸºæº–ï¼ˆå¯é¸ï¼‰
    â”‚   â”‚   â”œâ”€ è©•ä¼°å¯è¡Œæ€§
    â”‚   â”‚   â”œâ”€ ç”Ÿæˆå®Œæ•´ JSON
    â”‚   â”‚   â”œâ”€ ä½¿ç”¨ import_complete_plan âœ…
    â”‚   â”‚   â”œâ”€ ä½¿ç”¨ get_current_state é©—è­‰
    â”‚   â”‚   â””â”€ å ±å‘Šçµæœ
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ å ´æ™¯ Bï¼ˆä¿®æ”¹æ¨¡å¼ï¼‰
    â”‚       â”œâ”€ ä½¿ç”¨ get_current_state è®€å– âœ…
    â”‚       â”œâ”€ åˆ†æç•¶å‰ç‹€æ…‹
    â”‚       â”œâ”€ è­˜åˆ¥å•é¡Œå’Œç´„æŸ
    â”‚       â”œâ”€ åˆ¶å®šå„ªåŒ–ç­–ç•¥
    â”‚       â”œâ”€ ä½¿ç”¨ update_multiple_months èª¿æ•´ âœ…
    â”‚       â”œâ”€ ä½¿ç”¨ get_current_state é©—è­‰
    â”‚       â””â”€ å ±å‘Šçµæœ
    â”‚
    â””â”€ æ˜¯å¦éœ€è¦è¿­ä»£ï¼Ÿ
        â”œâ”€ YES â†’ é‡è¤‡ Step 2-4ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
        â””â”€ NO â†’ å®Œæˆ
```

---

**æ–‡æª”ç‰ˆæœ¬**: 2.0ï¼ˆæœ€çµ‚å®Œæ•´ç‰ˆï¼‰  
**å‰µå»ºæ—¥æœŸ**: 2025-12-11  
**æœ€å¾Œæ›´æ–°**: 2025-12-11  
**è² è²¬äºº**: AI Architect Mode  
**ç‹€æ…‹**: âœ… ç”¨æˆ¶ç¢ºèªå®Œæˆï¼Œæº–å‚™å¯¦ä½œ